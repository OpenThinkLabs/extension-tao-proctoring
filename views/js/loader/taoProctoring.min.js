!function(){"use strict";var loaderScript=document.getElementById("amd-loader"),configUrl=loaderScript.getAttribute("data-config"),bundle=loaderScript.getAttribute("data-bundle"),loadController=function(){var controllerOptions={},controllerPath=loaderScript.getAttribute("data-controller"),params=loaderScript.getAttribute("data-params");try{controllerOptions=JSON.parse(params)}catch(err){controllerOptions={}}window.require([controllerPath],function(controller){var startController=function(){window.started||(window.started=!0,controller.start(controllerOptions))};document.addEventListener("readystatechange",startController,!1),
"complete"===document.readyState&&startController()})};window.require([configUrl],function(){window.loadBundles||(window.loaded={},window.loadBundles=function(bundles){bundles=(bundles=(bundles=bundles||[]).concat(window.bundles)).filter(function(item,index){return item&&bundles.indexOf(item)===index&&!0!==window.loaded[item]}),require(bundles,function(){bundles.forEach(function(item){window.loaded[item]=!0}),loadController()})}),bundle||window.bundles&&window.bundles.length?window.loadBundles([bundle]):loadController()})}(),define("loader/bootstrap",function(){}),function(global,factory){
"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash")):"function"==typeof define&&define.amd?define("util/urlParser",["lodash"],factory):(global=global||self)["util/urlParser"]=factory(global._)}(this,function(_){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_;var urlParts=["hash","host","hostname","pathname","port","protocol","search"];function UrlParser(url){var detachedAnchor;this.url=url,(detachedAnchor=document.createElement("a")).href=url,this.data=_.pick(detachedAnchor,urlParts),this.params=UrlParser.extractParams(this.data.search)}return UrlParser.extractParams=function(search){var params={}
;return search.replace(/^\?/,"").replace(/([^=&]+)=([^&]*)/g,function(m,key,value){params[decodeURIComponent(key)]=decodeURIComponent(value)}),params},UrlParser.prototype.get=function(what){return!!_.contains(urlParts,what)&&this.data[what]},UrlParser.prototype.getParams=function(){return this.params},UrlParser.prototype.setParams=function(params){_.isObject(params)&&(this.params=params)},UrlParser.prototype.addParam=function(key,value){key&&(this.params[key]=value)},UrlParser.prototype.getPaths=function(){return this.data.pathname.replace(/^\/|\/$/g,"").split("/")},UrlParser.prototype.getUrl=function(exclude){var url="";return exclude=exclude||[],
this.data&&(this.data.hostname&&!_.contains(exclude,"host")&&(url+=(this.data.protocol?this.data.protocol:"http:")+"//"+this.data.hostname.replace(/\/$/,""),this.data.port&&80!==this.data.port&&"80"!==this.data.port&&"0"!==this.data.port&&(url+=":"+this.data.port)),/\/$/.test(url)||/^\//.test(this.data.pathname)||(url+="/"),url+=this.data.pathname,this.params&&!_.contains(exclude,"params")&&(url+="?",_.forEach(this.params,function(value,key){url+=encodeURIComponent(key)+"="+encodeURIComponent(value)+"&"}),url=url.substring(0,url.length-1)),this.data.hash&&!_.contains(exclude,"hash")&&(url+=this.data.hash)),url},UrlParser.prototype.getBaseUrl=function(){
var baseUrl=this.getUrl(["params","hash"]),paths=this.getPaths(),lastPart=paths[paths.length-1];return 0<paths.length&&/\.[a-z]+$/.test(lastPart)&&(baseUrl=baseUrl.replace(lastPart,"").replace(/\/\/$/,"/")),baseUrl},UrlParser.prototype.checkCORS=UrlParser.prototype.sameDomain=function(url){var parsedUrl;if(void 0===url&&(parsedUrl=new UrlParser(window.location)),"string"==typeof url&&(parsedUrl=new UrlParser(url)),url instanceof UrlParser&&(parsedUrl=url),!(parsedUrl instanceof UrlParser))throw new TypeError("Invalid url format");return"data:"===this.get("protocol")||"data:"===parsedUrl.get("protocol")||this.get("protocol")===parsedUrl.get("protocol"
)&&this.get("hostname")===parsedUrl.get("hostname")&&this.get("port")===parsedUrl.get("port")},UrlParser}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash")):"function"==typeof define&&define.amd?define("core/format",["lodash"],factory):(global=global||self)["core/format"]=factory(global._)}(this,function(_){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_;var pattern=/(%[sdj])/g;return function(message){var replacements=Array.prototype.slice.call(arguments,1);return _.reduce(message.match(pattern),function(acc,match,index){var replacement="";if(void 0!==replacements[index]){
switch(match){case"%d":replacement=Number(replacements[index]);break;case"%j":try{replacement=JSON.stringify(replacements[index]).replace(/"/g,"")}catch(e){}break;default:replacement=replacements[index]}message=message.replace(match,replacement)}return message},message)}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("core/promise",factory):(global=global||self)["core/promise"]=factory()}(this,function(){"use strict";return Promise}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),
require("core/format"),require("core/promise")):"function"==typeof define&&define.amd?define("core/logger/api",["lodash","core/format","core/promise"],factory):(global=global||self)["core/logger/api"]=factory(global._,global["core/format"],global["core/promise"])}(this,function(_,format,Promise){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_,format=format&&format.hasOwnProperty("default")?format.default:format,Promise=Promise&&Promise.hasOwnProperty("default")?Promise.default:Promise;function loggerFactory(name,minLevel,fields){var baseRecord,logger;if(!_.isString(name)||_.isEmpty(name))throw new TypeError("A logger needs a name")
;return _.isPlainObject(minLevel)&&"undefined"==typeof field&&(fields=minLevel,minLevel=defaultLevel),baseRecord=_.defaults(fields||{},{name:name,pid:1,hostname:navigator.userAgent}),logger={log:function(level,recordFields,message){var record,err,rest=[],time=(new Date).toISOString();if(!1!==loggerFactory.providers&&checkMinLevel(minLevel||defaultLevel,level))return rest=_.isString(recordFields)||recordFields instanceof Error?(message=recordFields,recordFields={},[].slice.call(arguments,2)):[].slice.call(arguments,3),record={level:getLevel(level),v:0,time:time},checkMinLevel(levels.error,level)||message instanceof Error?(
err=message instanceof Error?message:(message=_.isObject(message)?JSON.stringify(message):message,new Error(message)),record.msg=err.message,record.err=err):record.msg=format.apply(null,[message].concat(rest)),_.merge(record,baseRecord,recordFields),logQueue.push(record),loggerFactory.flush(),this},level:function(value){return void 0!==value?(minLevel=getLevelNum(value),this):getLevel(minLevel)},child:function(childFields){return loggerFactory(name,minLevel,_.defaults(childFields,baseRecord))}},_.reduce(levels,function(target,level,levelName){return target[levelName]=_.partial(logger.log,level),target},logger)}var defaultLevel="info",levels={fatal:60,
error:50,warn:40,info:30,debug:20,trace:10},logQueue=[],getLevel=function(level){return void 0===level||_.isString(level)&&!_.has(levels,level)?defaultLevel:_.isNumber(level)?_.findKey(levels,function(l){return l===level})||defaultLevel:level},getLevelNum=function(level){return _.isString(level)&&_.has(levels,level)?levels[level]:_.isNumber(level)&&_.contains(levels,level)?level:levels[defaultLevel]},checkMinLevel=function(minLevel,level){return getLevelNum(level)>=getLevelNum(minLevel)};return loggerFactory.levels=levels,loggerFactory.providers=!1,loggerFactory.load=function(providerConfigs){var self=this,modules=[];return this.providers=[],new Promise(
function(resolve,reject){_.forEach(providerConfigs,function(providerConfig,providerName){modules.push(providerName)}),require(modules,function(){var loadedProviders=[].slice.call(arguments);_.forEach(loadedProviders,function(provider,moduleKey){try{self.register(provider,providerConfigs[modules[moduleKey]])}catch(err){reject(err)}}),self.flush(),resolve()},reject)})},loggerFactory.register=function(provider,providerConfig){if(!_.isPlainObject(provider)||!_.isFunction(provider.log))throw new TypeError("A log provider is an object with a log method");provider.checkMinLevel=checkMinLevel,_.isFunction(provider.setConfig)&&provider.setConfig(providerConfig),
this.providers=this.providers||[],this.providers.push(provider)},loggerFactory.flush=function(){_.isArray(this.providers)&&0<this.providers.length&&(_.forEach(logQueue,function(message){_.forEach(loggerFactory.providers,function(provider){provider.log.call(provider,message)})}),logQueue=[])},loggerFactory.setDefaultLevel=function(level){return defaultLevel=getLevel(level)},loggerFactory}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("module"),require("core/logger/api")):"function"==typeof define&&define.amd?define("core/logger",["lodash","module","core/logger/api"],factory):(
global=global||self)["core/logger"]=factory(global._,global.module,global["core/logger/api"])}(this,function(_,module,loggerFactory){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_,module=module&&module.hasOwnProperty("default")?module.default:module;var defaultConfig={level:(loggerFactory=loggerFactory&&loggerFactory.hasOwnProperty("default")?loggerFactory.default:loggerFactory).levels.warn,loggers:{"core/logger/console":{level:"warn"}}},config=_.defaults(module.config()||{},defaultConfig),logger=loggerFactory("core/logger");return loggerFactory.setDefaultLevel(config.level),loggerFactory.load(config.loggers),window.onerror=function(msg,url,line,
col,error){logger.error("Caught[via window.onerror]: '"+msg+"' from "+url+":"+line+":"+col)},window.setTaoLogLevel=function(level){return loggerFactory.setDefaultLevel(level)},loggerFactory}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("context"),require("util/urlParser"),require("core/logger"),require("core/promise")):"function"==typeof define&&define.amd?define("core/router",["lodash","context","util/urlParser","core/logger","core/promise"],factory):(global=global||self)["core/router"]=factory(global._,global.context,global["util/urlParser"],global["core/logger"],
global["core/promise"])}(this,function(_,context,UrlParser,loggerFactory,Promise){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_,context=context&&context.hasOwnProperty("default")?context.default:context,UrlParser=UrlParser&&UrlParser.hasOwnProperty("default")?UrlParser.default:UrlParser,loggerFactory=loggerFactory&&loggerFactory.hasOwnProperty("default")?loggerFactory.default:loggerFactory,Promise=Promise&&Promise.hasOwnProperty("default")?Promise.default:Promise;var logger=loggerFactory("router");return{dispatch:function(urls,cb){var self=this;return _.isArray(urls)||(urls=[urls]),Promise.all(urls.map(function(url){return self.dispatchUrl(url)})
).then(function(){_.isFunction(cb)&&cb()}).catch(function(err){logger.error(err)})},parseMvcUrl:function(url){var parser,paths,route=null;return _.isString(url)&&!_.isEmpty(url)&&3<=(paths=(parser=new UrlParser(url)).getPaths()).length&&(route={action:paths[paths.length-1],module:paths[paths.length-2],extension:paths[paths.length-3],params:parser.getParams()}),route},loadRouteBundle:function(route){return route&&route.extension&&context.bundle&&"tao"!==route.extension?new Promise(function(resolve){var routeBundle=route.extension+"/loader/"+route.extension+".min";window.require([routeBundle],resolve,function(err){logger.warn(
"Unable to load "+routeBundle+" : "+err.message),resolve()})}):Promise.resolve()},loadRoute:function(route){return route&&route.extension?new Promise(function(resolve,reject){var routeModule="tao"===route.extension?"controller/routes":route.extension+"/controller/routes";window.require([routeModule],resolve,reject)}):Promise.resolve()},dispatchUrl:function(url){var self=this,route=this.parseMvcUrl(url);return logger.debug("Dispatch URL "+url),this.loadRouteBundle(route).then(function(){return self.loadRoute(route)}).then(function(routes){var moduleRoutes,action,dependencies=[],styles=[],moduleConfig={},mapStyle=function(style){
return"css!"+route.extension+"Css/"+style};return routes&&routes[route.module]&&((moduleRoutes=routes[route.module]).deps&&(dependencies=dependencies.concat(moduleRoutes.deps)),moduleRoutes.css&&(styles=_.isArray(moduleRoutes.css)?moduleRoutes.css:[moduleRoutes.css],dependencies=dependencies.concat(_.map(styles,mapStyle))),(moduleRoutes.actions&&moduleRoutes.actions[route.action]||moduleRoutes[route.action])&&(action=moduleRoutes.actions[route.action]||moduleRoutes[route.action],(_.isString(action)||_.isArray(action))&&(dependencies=dependencies.concat(action)),action.deps&&(dependencies=dependencies.concat(action.deps)),action.css&&(styles=_.isArray(
action.css)?action.css:[action.css],dependencies=dependencies.concat(_.map(styles,mapStyle)))),dependencies=_.map(dependencies,function(dep){return/^controller/.test(dep)&&"tao"!==route.extension?route.extension+"/"+dep:dep}),_.isEmpty(route.params)||(_.forEach(dependencies,function(dependency){moduleConfig[dependency]=_.merge(_.clone(window.requirejs.s.contexts._.config.config[dependency]||{}),route.params)}),window.requirejs.config({config:moduleConfig}))),dependencies}).then(function(dependencies){if(dependencies&&dependencies.length)return logger.debug("Load controllers : "+dependencies.join(", ")),new Promise(function(resolve,reject){window.require(
dependencies,function(){_.forEach(arguments,function(dependency){dependency&&_.isFunction(dependency.start)&&dependency.start()}),logger.debug(arguments.length+" controllers started"),resolve()},reject)})})}}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/promise"),require("lib/uuid"),require("core/logger")):"function"==typeof define&&define.amd?define("core/eventifier",["lodash","core/promise","lib/uuid","core/logger"],factory):(global=global||self)["core/eventifier"]=factory(global._,global["core/promise"],global["lib/uuid"],global["core/logger"])}(this,function(_,
Promise,uuid,loggerFactory){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise.default:Promise,uuid=uuid&&uuid.hasOwnProperty("default")?uuid.default:uuid,loggerFactory=loggerFactory&&loggerFactory.hasOwnProperty("default")?loggerFactory.default:loggerFactory;var defaultNs="@",eventifierLogger=loggerFactory("core/eventifier");function getEventNames(eventNames){return!_.isString(eventNames)||_.isEmpty(eventNames)?[]:_(eventNames.split(/\s/g)).compact().uniq().value()}function getName(eventName){return-1<eventName.indexOf(".")?eventName.substr(0,eventName.indexOf(".")):eventName}
function getNamespace(eventName){return-1<eventName.indexOf(".")?eventName.substr(eventName.indexOf(".")+1):defaultNs}return function(target){var targetName,logger,stoppedEvents,eventHandlers={},getHandlers=function(eventName,type){var name=getName(eventName),ns=getNamespace(eventName);return type=type||"between",eventHandlers[ns]=eventHandlers[ns]||{},eventHandlers[ns][name]=eventHandlers[ns][name]||{before:[],between:[],after:[]},eventHandlers[ns][name][type]},eventApi={on:function(eventNames,handler){return _.isFunction(handler)&&_.forEach(getEventNames(eventNames),function(eventName){getHandlers(eventName).push(handler)}),this},off:function(eventNames){
return _.forEach(getEventNames(eventNames),function(eventName){var offNamespaces,name=getName(eventName),ns=getNamespace(eventName);ns&&!name?"*"===ns?((offNamespaces={})[defaultNs]=eventHandlers[defaultNs],eventHandlers=offNamespaces):eventHandlers[ns]={}:_.forEach(eventHandlers,function(nsHandlers,namespace){!nsHandlers[name]||ns!==defaultNs&&ns!==namespace||(nsHandlers[name]={before:[],between:[],after:[]})})}),this},removeAllListeners:function(){return eventHandlers={},this},trigger:function(eventNames){var self=this,args=[].slice.call(arguments,1);function triggerBetween(allHandlers,event){shouldStop(event.name)?logHandlerStop("before",event
):triggerHandlers(allHandlers.between,event).then(function(){!function(handlers,event){shouldStop(event.name)?logHandlerStop("on",event):triggerHandlers(handlers,event).then(function(){shouldStop(event.name)&&logHandlerStop("after",event)}).catch(function(err){logHandlerStop("after",event,err)})}(allHandlers.after,event)}).catch(function(err){logHandlerStop("on",event,err)})}function triggerHandlers(handlers,event){var pHandlers;return pHandlers=handlers.map(function(handler){return shouldStop(event.name)?Promise.reject():handler.apply(self,args)}),Promise.all(pHandlers)}function logHandlerStop(stoppedIn,event,err){err instanceof Error&&logger.error(err),
logger.trace({err:err,event:event.name,stoppedIn:stoppedIn},event.name+" handlers stopped")}function shouldStop(name){return stoppedEvents[name]}return stoppedEvents={},_.forEach(getEventNames(eventNames),function(eventName){var ns=getNamespace(eventName),name=getName(eventName),mergedHandlers=_(eventHandlers).filter(function(nsHandlers,namespace){return nsHandlers[name]&&(ns===defaultNs||ns===namespace||"*"===namespace)}).reduce(function(acc,nsHandlers){return acc.before=acc.before.concat(nsHandlers[name].before),acc.between=acc.between.concat(nsHandlers[name].between),acc.after=acc.after.concat(nsHandlers[name].after),acc},{before:[],between:[],after:[]})
;logger.trace({event:eventName,args:args},"trigger %s",eventName),mergedHandlers&&function(allHandlers,name,ns){var event={name:name,namespace:ns};allHandlers.before.length?function(handlers,event){var pHandlers,beforeArgs=args.slice();return beforeArgs.unshift(event),pHandlers=handlers.map(function(handler){var value=!shouldStop(event.name)&&handler.apply(self,beforeArgs);return!1===value?Promise.reject():value}),Promise.all(pHandlers)}(allHandlers.before,event).then(function(){triggerBetween(allHandlers,event)}).catch(function(err){logHandlerStop("before",event,err)}):triggerBetween(allHandlers,event)}(mergedHandlers,name,ns)}),this},before:function(
eventNames,handler){return _.isFunction(handler)&&_.forEach(getEventNames(eventNames),function(eventName){getHandlers(eventName,"before").push(handler)}),this},after:function(eventNames,handler){return _.isFunction(handler)&&_.forEach(getEventNames(eventNames),function(eventName){getHandlers(eventName,"after").push(handler)}),this},stopEvent:function(name){_.isString(name)&&!_.isEmpty(name.trim())&&(stoppedEvents[name.trim()]=!0)},spread:function(destination,eventNames){var self=this;return destination&&_.isFunction(destination.trigger)&&(_.isString(eventNames)&&(eventNames=getEventNames(eventNames)),_.forEach(eventNames,function(eventName){self.on(eventName
,function(){var args=[eventName].concat([].slice.call(arguments));destination.trigger.apply(destination,args)})})),this}};return targetName=(target=target||{}).name||target.id||target.serial||uuid(6),logger=eventifierLogger.child({target:targetName}),_(eventApi).functions().forEach(function(method){_.isFunction(target[method])&&eventifierLogger.warn("The target object has already a method named "+method,target),target[method]=function(){var args=[].slice.call(arguments);return eventApi[method].apply(target,args)}}),target}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash")
):"function"==typeof define&&define.amd?define("core/statifier",["lodash"],factory):(global=global||self)["core/statifier"]=factory(global._)}(this,function(_){"use strict";return _=_&&_.hasOwnProperty("default")?_.default:_,function(target){var states={},statesApi={getState:function(name){return!!states[name]},setState:function(name,value){return void 0===value&&(value=!0),states[name]=!!value,this},clearStates:function(){return states={},this},getStates:function(){return _.reduce(states,function(result,state,key){return state&&result.push(key),result},[])}};return target=target||{},_(statesApi).functions().forEach(function(method){target[method]=function(
){var args=[].slice.call(arguments);return statesApi[method].apply(target,args)}}),target}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("jquery"),require("lodash"),require("core/router"),require("core/eventifier"),require("core/statifier"),require("core/promise")):"function"==typeof define&&define.amd?define("core/historyRouter",["jquery","lodash","core/router","core/eventifier","core/statifier","core/promise"],factory):(global=global||self)["core/historyRouter"]=factory(global.$,global._,global["core/router"],global["core/eventifier"],global["core/statifier"],global["core/promise"])}(this,
function($,_,router,eventifier,statifier,Promise){"use strict";var historyRouter;$=$&&$.hasOwnProperty("default")?$.default:$,_=_&&_.hasOwnProperty("default")?_.default:_,router=router&&router.hasOwnProperty("default")?router.default:router,eventifier=eventifier&&eventifier.hasOwnProperty("default")?eventifier.default:eventifier,statifier=statifier&&statifier.hasOwnProperty("default")?statifier.default:statifier,Promise=Promise&&Promise.hasOwnProperty("default")?Promise.default:Promise;var location=(window.history.location||window.location)+"";return function(){var pendingPromise;return historyRouter||(historyRouter=eventifier(statifier({redirect:function(
url){return this.pushState(url)},forward:function(url){var state=_.isString(url)?{url:url}:url;return window.history.replaceState(state,"",window.location+""),this.dispatch(state,!1)},replace:function(url){return this.dispatch(url,!0)},dispatch:function(state,replace){var self=this;function doDispatch(){return _.isString(state)&&(state={url:state}),state&&state.url?(self.setState("dispatching").trigger("dispatching",state.url),!0===replace&&window.history.replaceState(state,"",state.url),router.dispatch(state.url).then(function(){return self.trigger("dispatched",state.url).setState("dispatching",!1),state.url})):Promise.reject(new TypeError(
"The state should contain an URL!"))}return pendingPromise=pendingPromise?pendingPromise.then(doDispatch).catch(doDispatch):doDispatch()},pushState:function(state){return _.isString(state)&&(state={url:state}),window.history.pushState(state,"",state.url),this.dispatch(state)}})),window.history.replaceState({url:location},"",location),$(window).on("popstate",function(){historyRouter.dispatch(window.history.state)}),historyRouter.on("dispatch",function(state){state&&this.pushState(state)}),historyRouter)}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("context")
):"function"==typeof define&&define.amd?define("util/url",["lodash","context"],factory):(global=global||self)["util/url"]=factory(global._,global.context)}(this,function(_,context){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_,context=context&&context.hasOwnProperty("default")?context.default:context;var parsers={absolute:/^(?:[a-z]+:)?\/\//i,base64:/^data:[^\/]+\/[^;]+(;charset=[\w]+)?;base64,/,query:/(?:^|&)([^&=]*)=?([^&]*)/g,url:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/};return{parse:function(url){var matches,keys=["source","protocol","authority",
"userInfo","user","password","host","port","relative","path","directory","file","queryString","hash"],i=keys.length,parsed=Object.create({toString:function(){return this.source}});if(parsed.base64=parsers.base64.test(url),parsed.base64)parsed.source=url;else{for(matches=parsers.url.exec(url);i--;)parsed[keys[i]]=matches[i]||"";parsed.query={},parsed.queryString.replace(parsers.query,function($0,$1,$2){$1&&(parsed.query[$1]=$2)})}return parsed},isAbsolute:function(url){return"object"==typeof url&&url.hasOwnProperty("source")?url.source!==url.relative:"string"==typeof url?parsers.absolute.test(url):void 0},isRelative:function(url){var absolute=this.isAbsolute(
url);if("boolean"==typeof absolute)return!absolute},isBase64:function(url){return"object"==typeof url&&url.hasOwnProperty("source")?url.base64:"string"==typeof url?parsers.base64.test(url):void 0},encodeAsXmlAttr:function(uri){return/[<>&']+/.test(uri)?encodeURIComponent(uri):uri},build:function(path,params){var url,hasQueryString,queryString="";return path&&(_.isString(path)&&(url=path),_.isArray(path)&&(url="",_.forEach(path,function(chunk){/\/$/.test(url)&&/^\//.test(chunk)?url+=chunk.substr(1):""===url||/\/$/.test(url)||/^\//.test(chunk)?url+=chunk:url+="/"+chunk})),_.isPlainObject(params)&&(hasQueryString=-1<url.indexOf("?"),queryString=_.reduce(params,
function(acc,value,key){return _.isEmpty(acc)&&!hasQueryString||(acc+="&"),"object"!=typeof value||_.isArray(value)?acc+=encodeURIComponent(key)+"="+encodeURIComponent(value):_.forOwn(value,function(parameterValue,parameterName){acc+=encodeURIComponent(key)+"["+encodeURIComponent(parameterName)+"]="+encodeURIComponent(parameterValue)+"&"}),acc},queryString),_.isEmpty(queryString)||(hasQueryString||(url+="?"),url+=queryString))),url},route:function(action,controller,extension,params,rootUrl){var routeParts=[extension,controller,action];if(_.some(routeParts,function(value){return _.isEmpty(value)||!_.isString(value)}))throw new TypeError(
"All parts are required to build an URL");return rootUrl=rootUrl||context&&context.root_url,this.build([rootUrl].concat(routeParts),params)}}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("util/regexEscape",factory):(global=global||self)["util/regexEscape"]=factory()}(this,function(){"use strict";return function(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("util/regexEscape")):"function"==typeof define&&define.amd?define(
"util/wrapLongWords",["util/regexEscape"],factory):(global=global||self)["util/wrapLongWords"]=factory(global["util/regexEscape"])}(this,function(regexEscape){"use strict";regexEscape=regexEscape&&regexEscape.hasOwnProperty("default")?regexEscape.default:regexEscape;var getCutTerm=function(longWord,chunkExp){for(var cutTerms=longWord.match(chunkExp),i=cutTerms.length,oldFirst="",newFirst="",offenders=[".",":",";"];i--;)newFirst=cutTerms[i].charAt(0),-1<offenders.indexOf(newFirst)&&(cutTerms[i]=cutTerms[i].substr(1)),-1<offenders.indexOf(oldFirst)&&(cutTerms[i]=cutTerms[i]+oldFirst),oldFirst=newFirst;return cutTerms.join(" ")};return function(str,threshold){
str=str.toString().replace(/([\w])</g,"$1 <");for(var cut,chunkExp=new RegExp(".{1,"+threshold+"}","g"),longWords=str.match(new RegExp("[\\S]{"+threshold+",}","g"))||[],i=longWords.length;i--;)cut=getCutTerm(longWords[i],chunkExp),str=str.replace(new RegExp(regexEscape(longWords[i]),"g"),cut);return str}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("util/encode",factory):(global=global||self)["util/encode"]=factory()}(this,function(){"use strict";var _reQuot=/"/g,_reApos=/'/g,encodeHTML=function(html){return document.createElement("a").appendChild(
document.createTextNode(html)).parentNode.innerHTML};return{html:encodeHTML,attribute:function(html){return encodeHTML(html).replace(_reQuot,"&quot;").replace(_reApos,"&apos;")},encodeBase64:function(str){return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function(match,p1){return String.fromCharCode("0x"+p1)}))},decodeBase64:function(str){return decodeURIComponent(Array.prototype.map.call(atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""))}}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash")):"function"==typeof define&&define.amd?define(
"util/namespace",["lodash"],factory):(global=global||self)["util/namespace"]=factory(global._)}(this,function(_){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_;var reSplit=/\s/g,namespaceHelper={split:function(names,normalize){return!_.isString(names)||_.isEmpty(names)?[]:(normalize&&(names=names.toLowerCase()),_(names.trim().split(reSplit)).compact().uniq().value())},getName:function(namespaced){return!_.isString(namespaced)||_.isEmpty(namespaced)?"":-1<namespaced.indexOf(".")?namespaced.substr(0,namespaced.indexOf(".")):namespaced},getNamespace:function(namespaced,defaultNs){return!_.isString(namespaced)||_.isEmpty(namespaced
)?"":-1<namespaced.indexOf(".")?namespaced.substr(namespaced.indexOf(".")+1):defaultNs||"@"},namespaceAll:function(names,namespace,normalize){var suffix;return _.isArray(names)||(names=namespaceHelper.split(names,normalize)),normalize&&(namespace=namespace.toLowerCase()),suffix=namespace?"."+namespace:"",_(names).map(function(sh){return sh.indexOf(".")<0?sh+suffix:sh}).compact().uniq().value().join(" ")}};return namespaceHelper}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("jquery"),require("lodash"),require("util/namespace")):"function"==typeof define&&define.amd?define(
"util/shortcut/registry",["jquery","lodash","util/namespace"],factory):(global=global||self)["util/shortcut/registry"]=factory(global.$,global._,global["util/namespace"])}(this,function($,_,namespaceHelper){"use strict";$=$&&$.hasOwnProperty("default")?$.default:$,_=_&&_.hasOwnProperty("default")?_.default:_,namespaceHelper=namespaceHelper&&namespaceHelper.hasOwnProperty("default")?namespaceHelper.default:namespaceHelper;var modifiers={ctrl:"ctrlKey",alt:"altKey",option:"altKey",shift:"shiftKey",meta:"metaKey",cmd:"metaKey",win:"metaKey"},translateKeys={escape:"esc",arrowdown:"down",arrowleft:"left",arrowright:"right",arrowup:"up"},specialKeys={
8:"backspace",9:"tab",13:"enter",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"meta",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",145:"scrolllock",144:"numlock"};function registerEvent(target,eventName,listener){target.addEventListener?target.addEventListener(eventName,listener,!1):target.attachEvent?target.attachEvent("on"+eventName,listener):target["on"+eventName]=listener}function unregisterEvent(target,eventName,listener){target.removeEventListener?target.removeEventListener(
eventName,listener,!1):target.detachEvent?target.detachEvent("on"+eventName,listener):target["on"+eventName]=null}function normalizeCommand(descriptor){var key=translateKeys[descriptor.key]||descriptor.key,parts=[];return descriptor.ctrlKey&&parts.push("control"),descriptor.altKey&&parts.push("alt"),descriptor.shiftKey&&parts.push("shift"),descriptor.metaKey&&parts.push("meta"),descriptor.scrollDown&&parts.push("scrollDown"),descriptor.scrollUp&&parts.push("scrollUp"),descriptor.clickLeft&&parts.push("clickLeft"),descriptor.clickRight&&parts.push("clickRight"),descriptor.clickMiddle&&parts.push("clickMiddle"),descriptor.clickBack&&parts.push("clickBack"),
descriptor.clickForward&&parts.push("clickForward"),key&&parts.indexOf(key)<0&&parts.push(key),parts.join("+")}function parseCommand(shortcut){var parts=namespaceHelper.getName(shortcut).split("+"),descriptor={keyboardInvolved:!1,mouseClickInvolved:!1,mouseWheelInvolved:!1,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,key:null,scrollUp:null,scrollDown:null,clickLeft:null,clickRight:null,clickMiddle:null,clickBack:null,clickForward:null};return _.forEach(parts,function(part){if(modifiers[part])descriptor[modifiers[part]]=!0;else if(0<=part.indexOf("mouse")){if(descriptor.keyboardInvolved)throw new Error("A shortcut cannot involve both mouse and regular keys!")
;0<=part.indexOf("scroll")&&(descriptor.mouseWheelInvolved=!0,descriptor.scrollUp=0<=part.indexOf("up"),descriptor.scrollDown=0<=part.indexOf("down")),0<=part.indexOf("click")&&(descriptor.mouseClickInvolved=!0,descriptor.clickLeft=0<=part.indexOf("left"),descriptor.clickRight=0<=part.indexOf("right"),descriptor.clickMiddle=0<=part.indexOf("middle"),descriptor.clickBack=0<=part.indexOf("back"),descriptor.clickForward=0<=part.indexOf("forward"))}else{if(descriptor.mouseClickInvolved||descriptor.mouseWheelInvolved)throw new Error("A shortcut cannot involve both mouse and regular keys!");descriptor.keyboardInvolved=!0,descriptor.key=part}}),descriptor}
return function(root,defaultOptions){var keyboardIsRegistered=!1,mouseClickIsRegistered=!1,mouseWheelIsRegistered=!1,keyboardCount=0,mouseClickCount=0,mouseWheelCount=0,shortcuts={},handlers={},states={};function getHandlers(command,namespace){return handlers[namespace]=handlers[namespace]||{},handlers[namespace][command]=handlers[namespace][command]||[],handlers[namespace][command]}function getCommandHandlers(command){return _.reduce(handlers,function(acc,nsHandlers){return nsHandlers[command]&&(acc=acc.concat(nsHandlers[command])),acc},[])}function setOptions(descriptor,options){descriptor.options=_.defaults(_.merge(descriptor.options||{},options),
defaultOptions)}function unregisterKeyboard(){--keyboardCount<=0&&(keyboardCount=0,keyboardIsRegistered&&(unregisterEvent(root,"keydown",onKeyboard),keyboardIsRegistered=!1))}function unregisterMouseClick(){--mouseClickCount<=0&&(mouseClickCount=0,mouseClickIsRegistered&&(unregisterEvent(root,"click",onMouseClick),mouseClickIsRegistered=!1))}function unregisterMouseWheel(){--mouseWheelCount<=0&&(mouseWheelCount=0,mouseWheelIsRegistered&&(unregisterEvent(root,"wheel",onMouseWheel),mouseWheelIsRegistered=!1))}function registerCommand(command,descriptor){(shortcuts[command]=descriptor).keyboardInvolved&&(keyboardIsRegistered||(registerEvent(root,"keydown",
onKeyboard),keyboardIsRegistered=!0),keyboardCount++),descriptor.mouseClickInvolved&&(mouseClickIsRegistered||(registerEvent(root,"click",onMouseClick),mouseClickIsRegistered=!0),mouseClickCount++),descriptor.mouseWheelInvolved&&(mouseWheelIsRegistered||(registerEvent(root,"wheel",onMouseWheel),mouseWheelIsRegistered=!0),mouseWheelCount++)}function onKeyboard(event){processShortcut(event,{keyboardInvolved:!0,ctrlKey:event.ctrlKey,altKey:event.altKey,shiftKey:event.shiftKey,metaKey:event.metaKey,key:function(event){var code=event.which||event.keyCode,character=32<=code?String.fromCharCode(code).toLowerCase():"",key=event.key&&event.key.toLowerCase(),
keyName=event.code&&event.code.toLowerCase();return keyName&&(0===keyName.indexOf("key")?(key<"a"||"z"<key)&&"a"<=character&&character<="z"&&(key=character):0===keyName.indexOf("digit")&&(key=keyName.substr(5))),specialKeys[code]||key||character}(event)})}function onMouseClick(event){processShortcut(event,_.merge({mouseClickInvolved:!0,ctrlKey:event.ctrlKey,altKey:event.altKey,shiftKey:event.shiftKey,metaKey:event.metaKey},function(event){var buttons={clickLeft:!1,clickRight:!1,clickMiddle:!1,clickBack:!1,clickForward:!1};if(event.buttons)buttons.clickLeft=!!(1&event.buttons),buttons.clickRight=!!(2&event.buttons),buttons.clickMiddle=!!(4&event.buttons),
buttons.clickBack=!!(8&event.buttons),buttons.clickForward=!!(16&event.buttons);else switch(event.button){case 0:buttons.clickLeft=!0;break;case 1:buttons.clickMiddle=!0;break;case 2:buttons.clickRight=!0;break;case 3:buttons.clickBack=!0;break;case 4:buttons.clickForward=!0}return buttons}(event)))}function onMouseWheel(event){processShortcut(event,_.merge({mouseClickInvolved:!0,ctrlKey:event.ctrlKey,altKey:event.altKey,shiftKey:event.shiftKey,metaKey:event.metaKey},function(event){return{scrollUp:event.deltaY<0,scrollDown:0<event.deltaY}}(event)))}function processShortcut(event,descriptor){var shortcutHandlers,$target,command=normalizeCommand(descriptor),
shortcut=shortcuts[command];if(shortcut&&!states.disabled){if(!0===shortcut.options.avoidInput&&($target=$(event.target)).closest('[type="text"],textarea').length&&(!shortcut.options.allowIn||!$target.closest(shortcut.options.allowIn).length))return;!1===shortcut.options.propagate&&event.stopPropagation(),!0===shortcut.options.prevent&&event.preventDefault(),(shortcutHandlers=getCommandHandlers(command))&&_.forEach(shortcutHandlers,function(handler){handler(event,command)})}}return root.jquery&&(root=root.get(0)),{set:function(shortcut,options){return _.forEach(namespaceHelper.split(shortcut,!0),function(normalized){var descriptor=parseCommand(normalized),
command=normalizeCommand(descriptor);setOptions(descriptor,options),registerCommand(command,descriptor)}),this},add:function(shortcut,handler,options){return _.isFunction(handler)&&_.forEach(namespaceHelper.split(shortcut,!0),function(normalized){var namespace=namespaceHelper.getNamespace(normalized,"*"),descriptor=parseCommand(normalized),command=normalizeCommand(descriptor);setOptions(descriptor,options),registerCommand(command,descriptor),getHandlers(command,namespace).push(handler)}),this},remove:function(shortcut){return _.forEach(namespaceHelper.split(shortcut,!0),function(normalized){var namespace=namespaceHelper.getNamespace(normalized,"*"),
command=normalizeCommand(parseCommand(normalized));!function(command,namespace){namespace&&!command?handlers[namespace]={}:_.forEach(handlers,function(nsHandlers,ns){!nsHandlers[command]||"*"!==namespace&&namespace!==ns||(nsHandlers[command]=[])})}(command,namespace),getCommandHandlers(command).length||function(command){var descriptor=shortcuts[command];shortcuts[command]=null,descriptor&&(descriptor.keyboardInvolved&&unregisterKeyboard(),descriptor.mouseClickInvolved&&unregisterMouseClick(),descriptor.mouseWheelInvolved&&unregisterMouseWheel())}(command)}),this},exists:function(shortcut){var normalized=String(shortcut).trim().toLowerCase(),
namespace=namespaceHelper.getNamespace(normalized,"*"),command=normalizeCommand(parseCommand(normalized)),shortcutExists=!1;return shortcuts[command]?shortcutExists="*"===namespace||!!getHandlers(command,namespace).length:command||(shortcutExists=!_.isEmpty(handlers[namespace])),shortcutExists},clear:function(){return shortcuts={},handlers={},mouseWheelCount=mouseClickCount=keyboardCount=0,unregisterKeyboard(),unregisterMouseClick(),unregisterMouseWheel(),this},getState:function(name){return!!states[name]},setState:function(name,state){return states[name]=!!state,this},enable:function(){return this.setState("disabled",!1),this},disable:function(){
return this.setState("disabled",!0),this}}}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("jquery"),require("lodash")):"function"==typeof define&&define.amd?define("core/pluginifier",["jquery","lodash"],factory):(global=global||self)["core/pluginifier"]=factory(global.$,global._)}(this,function($,_){"use strict";$=$&&$.hasOwnProperty("default")?$.default:$,_=_&&_.hasOwnProperty("default")?_.default:_;var basePlugin={options:function(dataNs,ns,options){return this.each(function(){var $elt=$(this),currentOptions=$elt.data(dataNs);currentOptions&&$elt.data(dataNs,_.merge(currentOptions,options))})
},disable:function(dataNs,ns){return this.each(function(){var $elt=$(this),options=$elt.data(dataNs);options&&$elt.addClass(options.disableClass||"disabled").trigger("disable."+ns)})},enable:function(dataNs,ns){return this.each(function(){var $elt=$(this),options=$elt.data(dataNs);options&&$elt.removeClass(options.disableClass||"disabled").trigger("enable."+ns)})}};return{register:function(pluginName,plugin,config){var ns=(config=config||{}).ns||pluginName.toLowerCase(),dataNs=config.dataNs||"ui."+ns,expose=config.expose||[];return _.isFunction($.fn[pluginName])?$.error("A plugin named "+pluginName+" is already registered"):_.isPlainObject(plugin
)&&_.isFunction(plugin.init)?(_.assign(plugin,_.transform(basePlugin,function(result,prop,key){_.isFunction(prop)&&(result[key]=_.partial(basePlugin[key],dataNs,ns))})),_.forEach(expose,function(toExposeName){var privateMethod=toExposeName,publicMethod=toExposeName;/^_/.test(expose)?publicMethod=publicMethod.replace(/^_/,""):privateMethod="_"+privateMethod,_.isFunction(plugin[privateMethod])&&!_.isFunction(plugin[publicMethod])&&(plugin[publicMethod]=function(){var returnValue,args=Array.prototype.slice.call(arguments,0);return this.each(function(){returnValue=plugin[privateMethod].apply(plugin,[$(this)].concat(args))}),returnValue||this})}),void(
$.fn[pluginName]=function(method){if(plugin[method]){if(!/^_/.test(method))return plugin[method].apply(this,Array.prototype.slice.call(arguments,1));$.error("Trying to call a private method `"+method+"`")}else if("object"==typeof method||!method)return plugin.init.apply(this,arguments);$.error("Method "+method+" does not exist on plugin")})):$.error("The object to register as a jQuery plugin must be a plain object with an `init` method.")}}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("jquery"),require("lodash")):"function"==typeof define&&define.amd?define("core/dataattrhandler",["jquery",
"lodash"],factory):(global=global||self)["core/dataattrhandler"]=factory(global.$,global._)}(this,function($,_){"use strict";$=$&&$.hasOwnProperty("default")?$.default:$,_=_&&_.hasOwnProperty("default")?_.default:_;var defaults={container:!1,listenerEvent:"click",useTarget:!0,bubbled:!1},letDefaultOn=[":radio",":checkbox"],shouldPreventDefault=function($elt){return!$elt.is(letDefaultOn.join(","))},DataAttrHandler=function(attrName,options){var self=this;this.options=_.defaults(options,defaults);var selector="[data-"+attrName+"]";if(!_.has(this.options,"namespace")||!_.isString(this.options.namespace))return $.error(
"The plugin data namespace option is required");this.options.container&&this.options.container.selector&&(selector=this.options.container.selector+" "+selector),this.options.inner&&(selector+=" "+this.options.inner),$(document).off(this.options.listenerEvent,selector).on(this.options.listenerEvent,selector,function(e){var $target,$outer,$elt=$(e.target);!0!==self.options.bubbled&&!$elt.is(selector)||(void 0===$elt.data(attrName)&&(self.options.inner||self.options.bubbled)&&($elt=($outer=$elt).parents("[data-"+attrName+"]")),$target=!0===self.options.useTarget?DataAttrHandler.getTarget(attrName,$elt):self.options.inner?$outer:void 0,$elt.data(
self.options.namespace)||("function"==typeof self.createPlugin&&self.createPlugin($elt,$target),$elt.is(":radio")&&$elt.attr("name")&&$(':radio[name="'+$elt.attr("name")+'"]').not($elt).on(self.options.listenerEvent,function(e){"function"==typeof self.callPluginMethod&&self.callPluginMethod($elt,$target),shouldPreventDefault($elt)&&e.preventDefault()})),"function"==typeof self.callPluginMethod&&self.callPluginMethod($elt,$target),shouldPreventDefault($elt)&&e.preventDefault())})};return DataAttrHandler.prototype.init=function(cb){return this.createPlugin=cb,this},DataAttrHandler.prototype.trigger=function(cb){return this.callPluginMethod=cb,this},
DataAttrHandler.getTarget=function(attrName,$elt){var relativeRegex=/^(\+|>|~|:parent|<)/,$target=[],targetSelector=$elt.attr("data-"+attrName)||$elt.attr("href")||$elt.attr("attrName");if(!_.isEmpty(targetSelector)){var matches=relativeRegex.exec(targetSelector);if(null!==matches){var selector=targetSelector.replace(relativeRegex,"");$target=":parent"===matches[0]||"<"===matches[0]?$elt.parents(selector):"~"===matches[0]?$elt.siblings(selector):"+"===matches[0]?$elt.next(selector):$(selector,$elt)}else $target=$(targetSelector)}return $target},DataAttrHandler}),function(global,factory){
"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/promise"),require("core/eventifier"),require("lib/uuid")):"function"==typeof define&&define.amd?define("core/promiseQueue",["lodash","core/promise","core/eventifier","lib/uuid"],factory):(global=global||self)["core/promiseQueue"]=factory(global._,global["core/promise"],global["core/eventifier"],global["lib/uuid"])}(this,function(_,Promise,eventifier,uuid){"use strict";return _=_&&_.hasOwnProperty("default")?_.default:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise.default:Promise,eventifier=eventifier&&eventifier.hasOwnProperty("default"
)?eventifier.default:eventifier,uuid=uuid&&uuid.hasOwnProperty("default")?uuid.default:uuid,function(){function getId(){var id="promise-"+uuid(6);return void 0===queue[id]?id:getId()}var queue={};return{add:function(promise){return queue[getId()]=promise,this},getValues:function(){return _.values(queue)},clear:function(){return queue={},this},serie:function(promiseFn){var id=getId(),currentQueue=this.getValues(),emitter=eventifier();return queue[id]=new Promise(function(resolve){emitter.on("fulfilled",resolve)}),Promise.all(currentQueue).then(function(){if(_.isFunction(promiseFn))return promiseFn()}).then(function(data){return emitter.trigger("fulfilled"),
delete queue[id],data}).catch(function(err){throw queue={},err})}}}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/promise"),require("core/promiseQueue"),require("lib/uuid")):"function"==typeof define&&define.amd?define("core/store/localstorage",["lodash","core/promise","core/promiseQueue","lib/uuid"],factory):(global=global||self)["core/store/localstorage"]=factory(global._,global["core/promise"],global["core/promiseQueue"],global["lib/uuid"])}(this,function(_,Promise,promiseQueue,uuid){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_,
Promise=Promise&&Promise.hasOwnProperty("default")?Promise.default:Promise,promiseQueue=promiseQueue&&promiseQueue.hasOwnProperty("default")?promiseQueue.default:promiseQueue,uuid=uuid&&uuid.hasOwnProperty("default")?uuid.default:uuid;var storage=window.localStorage,writingQueue=promiseQueue(),setEntry=function(storeName,key,value){return new Promise(function(resolve,reject){try{storage.setItem("tao-store-"+storeName+"."+key,JSON.stringify(value)),resolve(!0)}catch(ex){reject(ex)}})},getEntry=function(storeName,key){return new Promise(function(resolve,reject){var value;try{null===(value=storage.getItem("tao-store-"+storeName+"."+key))?resolve():resolve(
JSON.parse(value))}catch(ex){reject(ex)}})},getKnownStores=function(){return getEntry("index","stores")},localStorageBackend=function(storeName){var name,registered=!1,openStore=function(){return registered?Promise.resolve():function(storeName){return getKnownStores().then(function(stores){return(stores=stores||{})[storeName]={name:storeName,lastOpen:Date.now()},setEntry("index","stores",stores)})}(storeName).then(function(){registered=!0})};if(_.isEmpty(storeName)||!_.isString(storeName))throw new TypeError("The store name is required");return name="tao-store-"+storeName+".",{getItem:function(key){return writingQueue.serie(function(){return openStore(
).then(function(){return getEntry(storeName,key)})})},setItem:function(key,value){return writingQueue.serie(function(){return openStore().then(function(){return setEntry(storeName,key,value)})})},removeItem:function(key){return writingQueue.serie(function(){return openStore().then(function(){return storage.removeItem(name+key),!0})})},getItems:function(){var keyPattern=new RegExp("^"+name);return writingQueue.serie(function(){return openStore().then(function(){return _(storage).map(function(entry,index){return storage.key(index)}).filter(function(key){return keyPattern.test(key)}).reduce(function(acc,key){var value,exposedKey=key.replace(name,"");try{
null!==(value=storage.getItem(key))&&(acc[exposedKey]=JSON.parse(value))}catch(ex){acc[exposedKey]=null}return acc},{})})})},clear:function(){var keyPattern=new RegExp("^"+name);return writingQueue.serie(function(){return openStore().then(function(){return _(storage).map(function(entry,index){return storage.key(index)}).filter(function(key){return keyPattern.test(key)}).forEach(function(key){storage.removeItem(key)}),!0})})},removeStore:function(){return this.clear().then(function(){return function(storeName){return getKnownStores().then(function(stores){return delete(stores=stores||{})[storeName],setEntry("index","stores",stores)})}(storeName)})}}}
;return localStorageBackend.removeAll=function(validate){return _.isFunction(validate)||(validate=null),getKnownStores().then(function(stores){var removing=_(stores).filter(function(store,storeName){return!validate||validate(storeName,store)}).map(function(store){return store&&store.name?localStorageBackend(store.name).removeStore():Promise.resolve()}).value();return Promise.all(removing)})},localStorageBackend.getAll=function(validate){return getKnownStores().then(function(stores){return _(stores).filter(function(store,storeName){return!validate||validate(storeName,store)}).map(function(store){return store.name}).value()})},
localStorageBackend.getStoreIdentifier=function(){var idStore=localStorageBackend("id");return idStore.getItem("id").then(function(id){return _.isEmpty(id)?(id=uuid(),idStore.setItem("id",id).then(function(){return id})):id})},localStorageBackend}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/promise"),require("lib/store/idbstore"),require("lib/uuid")):"function"==typeof define&&define.amd?define("core/store/indexeddb",["lodash","core/promise","lib/store/idbstore","lib/uuid"],factory):(global=global||self)["core/store/indexeddb"]=factory(global._,global["core/promise"],
global["lib/store/idbstore"],global["lib/uuid"])}(this,function(_,Promise,IDBStore,uuid){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise.default:Promise,IDBStore=IDBStore&&IDBStore.hasOwnProperty("default")?IDBStore.default:IDBStore,uuid=uuid&&uuid.hasOwnProperty("default")?uuid.default:uuid;var knownStores,isIndexedDB2="getAll"in IDBObjectStore.prototype,openStore=function(storeName){return new Promise(function(resolve,reject){var store=new IDBStore({dbVersion:1,storeName:storeName,storePrefix:"tao-store-",keyPath:"key",autoIncrement:!0,onStoreReady:function(){
store.db.onversionchange=function(e){e&&e.newVersion||store.db.close()},resolve(store)},onError:reject})})},setEntry=function(store,key,value){return new Promise(function(resolve,reject){var entry={key:key,value:value};store.put(entry,function(returnKey){resolve(returnKey===key)},reject)})},getEntry=function(store,key){return new Promise(function(resolve,reject){store.get(key,function(entry){if(!entry||void 0===entry.value)return resolve(entry);resolve(entry.value)},reject)})},removeEntry=function(store,key){return new Promise(function(resolve,reject){store.remove(key,function(result){resolve(!1!==result)},reject)})},getKnownStores=function(){
return knownStores||(knownStores=openStore("index")),knownStores},deleteStore=function(store,storeName){return new Promise(function(resolve,reject){var success=function(){(function(storeName){return getKnownStores().then(function(store){return removeEntry(store,storeName)})})(storeName).then(function(){resolve(!0)}).catch(reject)};isIndexedDB2?store.deleteDatabase(success,reject):store.clear(success,reject)})},indexDbBackend=function(storeName){var innerStore,writePromise,getStore=function(){return innerStore||(innerStore=openStore(storeName).then(function(store){return function(storeName){return getKnownStores().then(function(store){return setEntry(store,
storeName,{name:storeName,lastOpen:Date.now()})})}(storeName).then(function(){return Promise.resolve(store)})})),innerStore},ensureSerie=function(getWritingPromise){return writePromise?new Promise(function(resolve,reject){function runWrite(){var p=getWritingPromise();(writePromise=p).then(resolve).catch(reject)}writePromise.then(runWrite).catch(runWrite)}):writePromise=getWritingPromise()};if(_.isEmpty(storeName)||!_.isString(storeName))throw new TypeError("The store name is required");return{getItem:function(key){return ensureSerie(function(){return getStore().then(function(store){return getEntry(store,key)})})},setItem:function(key,value){
return ensureSerie(function(){return getStore().then(function(store){return setEntry(store,key,value)})})},removeItem:function(key){return ensureSerie(function(){return getStore().then(function(store){return removeEntry(store,key)})})},getItems:function(){return ensureSerie(function(){return getStore().then(function(store){return function(store){return new Promise(function(resolve,reject){store.getAll(function(entries){if(!_.isArray(entries))return resolve({});resolve(_.reduce(entries,function(acc,entry){return entry.key&&entry.value&&(acc[entry.key]=entry.value),acc},{}))},reject)})}(store)})})},clear:function(){return ensureSerie(function(){
return getStore().then(function(store){return new Promise(function(resolve,reject){store.clear(function(){resolve(!0)},reject)})})})},removeStore:function(){return ensureSerie(function(){return getStore().then(function(store){return deleteStore(store,storeName)})})}}};return indexDbBackend.removeAll=function(validate){return _.isFunction(validate)||(validate=null),getKnownStores().then(function(store){return new Promise(function(resolve,reject){store.getAll(function(entries){var all=[];_.forEach(entries,function(entry){var storeName=entry&&entry.key;storeName&&all.push(openStore(storeName).then(function(storeToRemove){if(!validate||validate(storeName,
entry.value))return deleteStore(storeToRemove,storeName)}))}),Promise.all(all).then(resolve).catch(reject)},reject)})})},indexDbBackend.getAll=function(validate){return _.isFunction(validate)||(validate=function(){return!0}),getKnownStores().then(function(store){return new Promise(function(resolve,reject){store.getAll(function(entries){var storeNames=_(entries).filter(function(entry){return entry&&entry.key&&validate(entry.key,entry.value)}).map(function(entry){return entry.key}).value();return resolve(storeNames)},reject)})})},indexDbBackend.getStoreIdentifier=function(){return openStore("id").then(function(store){return getEntry(store,"id").then(function(
id){return _.isEmpty(id)?(id=uuid(),setEntry(store,"id",id).then(function(){return id})):id})})},indexDbBackend}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/promise"),require("lib/uuid")):"function"==typeof define&&define.amd?define("core/store/memory",["lodash","core/promise","lib/uuid"],factory):(global=global||self)["core/store/memory"]=factory(global._,global["core/promise"],global["lib/uuid"])}(this,function(_,Promise,uuid){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise.default:Promise,
uuid=uuid&&uuid.hasOwnProperty("default")?uuid.default:uuid;var idStore,memoryStore={},memoryStorageBackend=function(storeName){if(_.isEmpty(storeName)||!_.isString(storeName))throw new TypeError("The store name is required");return memoryStore[storeName]=memoryStore[storeName]||{},{getItem:function(key){return _.isPlainObject(memoryStore[storeName])?Promise.resolve(memoryStore[storeName][key]):Promise.resolve()},setItem:function(key,value){return _.isPlainObject(memoryStore[storeName])||(memoryStore[storeName]={}),memoryStore[storeName][key]=value,Promise.resolve(!0)},removeItem:function(key){return memoryStore[storeName]=_.omit(memoryStore[storeName],key),
Promise.resolve(void 0===memoryStore[storeName][key])},getItems:function(){return Promise.resolve(memoryStore[storeName])},clear:function(){return memoryStore[storeName]={},Promise.resolve(!0)},removeStore:function(){return memoryStore=_.omit(memoryStore,storeName),Promise.resolve(void 0===memoryStore[storeName])}}};return memoryStorageBackend.removeAll=function(validate){return _.isFunction(validate)||(validate=null),memoryStore=_.omit(memoryStore,function(store,storeName){return!validate||validate(storeName)}),Promise.resolve(!0)},memoryStorageBackend.getAll=function(validate){var storeNames;return _.isFunction(validate)||(validate=null),storeNames=_(
memoryStore).map(function(store,storeName){return storeName}).filter(function(storeName){return!validate||validate(storeName)}).value(),Promise.resolve(storeNames)},memoryStorageBackend.getStoreIdentifier=function(){return _.isEmpty(idStore)&&(idStore=uuid()),Promise.resolve(idStore)},memoryStorageBackend}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("moment"),require("module"),require("core/logger"),require("core/promise"),require("core/store/localstorage"),require("core/store/indexeddb"),require("core/store/memory")):"function"==typeof define&&define.amd?define("core/store",
["lodash","moment","module","core/logger","core/promise","core/store/localstorage","core/store/indexeddb","core/store/memory"],factory):(global=global||self)["core/store"]=factory(global._,global.moment,global.module,global["core/logger"],global["core/promise"],global["core/store/localstorage"],global["core/store/indexeddb"],global["core/store/memory"])}(this,function(_,moment,module,loggerFactory,Promise,localStorageBackend,indexedDBBackend,memoryBackend){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_,moment=moment&&moment.hasOwnProperty("default")?moment.default:moment,module=module&&module.hasOwnProperty("default")?module.default:module,
loggerFactory=loggerFactory&&loggerFactory.hasOwnProperty("default")?loggerFactory.default:loggerFactory,Promise=Promise&&Promise.hasOwnProperty("default")?Promise.default:Promise,localStorageBackend=localStorageBackend&&localStorageBackend.hasOwnProperty("default")?localStorageBackend.default:localStorageBackend,indexedDBBackend=indexedDBBackend&&indexedDBBackend.hasOwnProperty("default")?indexedDBBackend.default:indexedDBBackend,memoryBackend=memoryBackend&&memoryBackend.hasOwnProperty("default")?memoryBackend.default:memoryBackend;var store,supportsIndexedDB=!1,dectectionDone=!1,quotaChecked=!1,backendApi=["removeAll","getAll","getStoreIdentifier"],
storeApi=["getItem","setItem","removeItem","getItems","clear","removeStore"],logger=loggerFactory("core/store"),config=_.defaults(module.config()||{},{lowSpaceRatio:80,invalidation:{staled:"P2W",oldster:"P2M"}}),isIndexDBSupported=function(){return dectectionDone?Promise.resolve(supportsIndexedDB):new Promise(function(resolve){var test,indexedDB,done=function(result){return dectectionDone=!0,resolve(supportsIndexedDB=!!result)};try{if(!(indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB))return done(!1);(test=indexedDB.open("__feature_test",1)).onsuccess=function(){if(test.result
)return test.result.close(),done(!0)},test.onerror=function(e){return e.preventDefault(),done(!1),!1}}catch(err){done(!1)}})},loadBackend=function(preselectedBackend){return isIndexDBSupported().then(function(){var backend=preselectedBackend||(supportsIndexedDB?indexedDBBackend:localStorageBackend);return _.isFunction(backend)?function(backend){return _.all(backendApi,function(method){return _.isFunction(backend[method])})}(backend)?(backend!==memoryBackend&&(!quotaChecked&&"storage"in window.navigator&&window.navigator.storage.estimate&&window.navigator.storage.estimate().then(function(estimate){var usedRatio=0;_.isNumber(estimate.usage)&&_.isNumber(
estimate.quota)&&0<estimate.quota&&((usedRatio=estimate.usage/estimate.quota)>config.lowSpaceRatio?(logger.warn("The browser storage is getting low "+usedRatio.toFixed(2)+"% used",estimate),logger.warn("We will attempt to clean oldster databases in persistent backends"),store.cleanUpSpace(config.invalidation.oldster,[],localStorageBackend),store.cleanUpSpace(config.invalidation.oldster,[],indexedDBBackend)):logger.debug("Browser storage estimate : "+usedRatio.toFixed(2)+"% used",estimate))}).catch(function(err){logger.warn("Unable to retrieve quotas : "+err.message)}),quotaChecked=!0),backend):Promise.reject(new TypeError(
"This backend doesn't comply with the store backend API")):Promise.reject(new TypeError("No backend, no storage!"))})};return(store=function(storeName,preselectedBackend){return loadBackend(preselectedBackend).then(function(backend){var storeInstance=backend(storeName);return function(storage){return _.all(storeApi,function(method){return _.isFunction(storage[method])})}(storeInstance)?storeInstance:Promise.reject(new TypeError("The store doesn't comply with the Storage interface"))})}).backends={localStorage:localStorageBackend,indexedDB:indexedDBBackend,memory:memoryBackend},store.removeAll=function(validate,preselectedBackend){return loadBackend(
preselectedBackend).then(function(backend){return backend.removeAll(validate)})},store.cleanUpSpace=function(since,storeNamePattern,preselectedBackend){var tsThreshold;return tsThreshold=_.isNumber(since)&&0<since?since:(_.isString(since)||(since=config.invalidation.oldster),moment().subtract(moment.duration(since)).valueOf()),logger.info("Trying to remove stores lastly opened before "+tsThreshold+"("+since+")"),store.removeAll(function(storeName,storeEntry){return!(!storeName||!storeEntry)&&(!(storeNamePattern instanceof RegExp&&!storeNamePattern.test(storeName))&&(_.isNumber(storeEntry.lastOpen)&&_.isNumber(tsThreshold)&&storeEntry.lastOpen<=tsThreshold))}
,preselectedBackend)},store.getAll=function(validate,preselectedBackend){return loadBackend(preselectedBackend).then(function(backend){return backend.getAll(validate)})},store.getIdentifier=function(preselectedBackend){return loadBackend(preselectedBackend).then(function(backend){return backend.getStoreIdentifier()})},store}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/promise"),require("core/store")):"function"==typeof define&&define.amd?define("core/tokenStore",["lodash","core/promise","core/store"],factory):(global=global||self)["core/tokenStore"]=factory(global._,
global["core/promise"],global["core/store"])}(this,function(_,Promise,store){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise.default:Promise,store=store&&store.hasOwnProperty("default")?store.default:store;var defaultConfig={maxSize:6,tokenTimeLimit:144e4};return function(options){var config=_.defaults(options||{},defaultConfig),getStore=function(){return store("tokenStore.tokens",store.backends.memory)};return{dequeue:function(){var self=this;return self.getIndex().then(function(latestIndex){var key=_.first(latestIndex);return key?getStore().then(function(storage){return storage.getItem(
key)}).then(function(token){return self.remove(key).then(function(){return token})}):Promise.resolve()})},enqueue:function(token){var self=this;return _.isString(token)&&(token={value:token,receivedAt:Date.now()}),getStore().then(function(storage){return storage.setItem(token.value,token)}).then(function(updated){return!!updated&&self.enforceMaxSize().then(function(){return!0})})},getIndex:function(){return this.getTokens().then(function(tokens){return _.chain(tokens).values().sort(function(t1,t2){return t1.receivedAt-t2.receivedAt}).map("value").value()})},has:function(key){return this.getIndex().then(function(latestIndex){return _.contains(latestIndex,key)
})},remove:function(key){return this.has(key).then(function(result){return!!result&&getStore().then(function(storage){return storage.removeItem(key)})})},clear:function(){return getStore().then(function(storage){return storage.clear()})},getTokens:function(){return getStore().then(function(storage){return storage.getItems()})},getSize:function(){return this.getIndex().then(function(latestIndex){return latestIndex.length})},setMaxSize:function(size){_.isNumber(size)&&0<size&&size!==config.maxSize&&(config.maxSize=size,this.enforceMaxSize())},enforceMaxSize:function(){var self=this;return this.getIndex().then(function(latestIndex){var keysToRemove,
excess=latestIndex.length-config.maxSize;return!(0<excess)||(keysToRemove=latestIndex.slice(0,excess),Promise.all(_.map(keysToRemove,function(key){return self.remove(key)})))})},checkExpiry:function(token){return!(Date.now()-token.receivedAt>config.tokenTimeLimit)||this.remove(token.value)},expireOldTokens:function(){var self=this;return self.getTokens().then(function(tokens){return _.reduce(tokens,function(previousPromise,nextToken){return previousPromise.then(function(){return self.checkExpiry(nextToken)})},Promise.resolve()).then(function(){return!0})})}}}}),function(global,factory){
"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("module"),require("core/tokenStore"),require("core/promise"),require("core/promiseQueue")):"function"==typeof define&&define.amd?define("core/tokenHandler",["lodash","module","core/tokenStore","core/promise","core/promiseQueue"],factory):(global=global||self)["core/tokenHandler"]=factory(global._,global.module,global["core/tokenStore"],global["core/promise"],global["core/promiseQueue"])}(this,function(_,module,tokenStoreFactory,Promise,promiseQueue){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_,module=module&&module.hasOwnProperty("default"
)?module.default:module,tokenStoreFactory=tokenStoreFactory&&tokenStoreFactory.hasOwnProperty("default")?tokenStoreFactory.default:tokenStoreFactory,Promise=Promise&&Promise.hasOwnProperty("default")?Promise.default:Promise,promiseQueue=promiseQueue&&promiseQueue.hasOwnProperty("default")?promiseQueue.default:promiseQueue;var clientConfigFetched=!1,defaults={maxSize:6,tokenTimeLimit:144e4};return function(options){var tokenStore;return _.isString(options)&&(options={initialToken:options}),options=_.defaults({},options,defaults),tokenStore=tokenStoreFactory(options),{getToken:function(){var self=this,initialToken=options.initialToken,
getFirstTokenValue=function(){return tokenStore.dequeue().then(function(currentToken){return currentToken?currentToken.value:null})};return initialToken?(options.initialToken=null,Promise.resolve(initialToken)):tokenStore.expireOldTokens().then(function(){return tokenStore.getSize()}).then(function(queueSize){return 0<queueSize?getFirstTokenValue():clientConfigFetched?Promise.reject(new Error("No tokens available. Please refresh the page.")):self.getClientConfigTokens().then(getFirstTokenValue)})},setToken:function(newToken){return tokenStore.enqueue(newToken)},getClientConfigTokens:function(){var self=this,clientTokens=_.map(module.config().tokens,function(
serverToken){return{value:serverToken,receivedAt:Date.now()}});return clientConfigFetched=!0,Promise.resolve(clientTokens).then(function(newTokens){var setTokenQueue=promiseQueue();return _.forEach(newTokens,function(token){setTokenQueue.serie(function(){return self.setToken(token)})}),setTokenQueue.serie(function(){return!0})})},clearStore:function(){return tokenStore.clear()},getQueueLength:function(){return tokenStore.getSize()},setMaxSize:function(size){tokenStore.setMaxSize(size)}}}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("jquery"),require("lodash"),require("i18n"),require("module"),
require("context"),require("core/promise"),require("core/promiseQueue"),require("core/tokenHandler"),require("core/logger")):"function"==typeof define&&define.amd?define("core/request",["jquery","lodash","i18n","module","context","core/promise","core/promiseQueue","core/tokenHandler","core/logger"],factory):(global=global||self)["core/request"]=factory(global.$,global._,global.__,global.module,global.context,global["core/promise"],global["core/promiseQueue"],global["core/tokenHandler"],global["core/logger"])}(this,function($,_,__,module,context,Promise,promiseQueue,tokenHandlerFactory,loggerFactory){"use strict";$=$&&$.hasOwnProperty("default")?$.default:$,
_=_&&_.hasOwnProperty("default")?_.default:_,__=__&&__.hasOwnProperty("default")?__.default:__,module=module&&module.hasOwnProperty("default")?module.default:module,context=context&&context.hasOwnProperty("default")?context.default:context,Promise=Promise&&Promise.hasOwnProperty("default")?Promise.default:Promise,promiseQueue=promiseQueue&&promiseQueue.hasOwnProperty("default")?promiseQueue.default:promiseQueue,tokenHandlerFactory=tokenHandlerFactory&&tokenHandlerFactory.hasOwnProperty("default")?tokenHandlerFactory.default:tokenHandlerFactory,loggerFactory=loggerFactory&&loggerFactory.hasOwnProperty("default")?loggerFactory.default:loggerFactory
;var tokenHandler=tokenHandlerFactory(),queue=promiseQueue(),logger=loggerFactory("core/request"),createError=function(response,fallbackMessage,httpCode,httpSent){var err;return(err=response&&response.errorCode?new Error(response.errorCode+" : "+(response.errorMsg||response.errorMessage||response.error)):new Error(fallbackMessage)).response=response,err.sent=httpSent,httpCode&&(err.code=httpCode),err};return function(options){if(module.config().noToken&&(options.noToken=!0),_.isEmpty(options.url))throw new TypeError("At least give a URL...");function runRequest(){var headers,setTokenFromXhr=function(xhr){var token;return _.isFunction(xhr.getResponseHeader
)&&(token=xhr.getResponseHeader("X-CSRF-Token"),logger.debug("received %s header %s","X-CSRF-Token",token),token)?tokenHandler.setToken(token):Promise.resolve()};return(headers=_.extend({},options.headers),options.noToken?Promise.resolve(headers):tokenHandler.getToken().then(function(token){return headers["X-CSRF-Token"]=token||"none",headers})).then(function(customHeaders){return new Promise(function(resolve,reject){$.ajax({url:options.url,method:options.method||"GET",headers:customHeaders,data:options.data,contentType:options.contentType||void 0,dataType:options.dataType||"json",async:!0,timeout:1e3*options.timeout||1e3*context.timeout||0,
beforeSend:function(){_.isEmpty(customHeaders)||logger.debug("sending %s header %s","X-CSRF-Token",customHeaders&&customHeaders["X-CSRF-Token"])},global:!options.background}).done(function(response,status,xhr){setTokenFromXhr(xhr).then(function(){return 204===xhr.status||response&&204===response.errorCode||"nocontent"===status?resolve():403===xhr.status||response&&403===response.errorCode?reject(createError(response,xhr.status+" : "+xhr.statusText,xhr.status,0<xhr.readyState)):200===xhr.status||response&&!0===response.success?resolve(response):void reject(createError(response,__("The server has sent an empty response"),xhr.status,0<xhr.readyState))}).catch(
function(error){logger.error(error),reject(createError(response,error,xhr.status,0<xhr.readyState))})}).fail(function(xhr,textStatus,errorThrown){var response;try{response=JSON.parse(xhr.responseText)}catch(parseErr){response=xhr.responseText}response=_.defaults(response,{success:!1,source:"network",cause:options.url,purpose:"proxy",context:this,code:xhr.status,sent:0<xhr.readyState,type:"error",message:errorThrown||__("An error occurred!")}),setTokenFromXhr(xhr).then(function(){reject(createError(response,xhr.status+" : "+xhr.statusText,xhr.status,0<xhr.readyState))}).catch(function(error){logger.error(error),reject(createError(response,error,xhr.status,
0<xhr.readyState))})})})})}return tokenHandler.getQueueLength().then(function(queueLength){return!0===options.noToken?runRequest():options.sequential||1===queueLength?queue.serie(runRequest):runRequest()})}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/request")):"function"==typeof define&&define.amd?define("core/dataProvider/request",["lodash","core/request"],factory):(global=global||self)["core/dataProvider/request"]=factory(global._,global["core/request"])}(this,function(_,coreRequest){"use strict";return _=_&&_.hasOwnProperty("default")?_.default:_,
coreRequest=coreRequest&&coreRequest.hasOwnProperty("default")?coreRequest.default:coreRequest,function(url,data,method,headers,background,noToken){return coreRequest({url:url,data:data,method:method,headers:headers,background:background,noToken:!1!==noToken}).then(function(response){return _.isUndefined(response)?Promise.resolve():response.success?Promise.resolve(response.data):Promise.reject(response)}).catch(function(error){return Promise.reject(error)})}}),define("taoProctoring/controller/app",["lodash","controller/app","core/dataProvider/request","ui/container","ui/breadcrumbs","util/url"],function(_,appController,request,containerFactory,
breadcrumbsFactory,urlHelper){"use strict";var breadcrumbsUrl=urlHelper.route("load","Breadcrumbs","tao"),knownRoutes=[{url:urlHelper.route("index","DeliverySelection","taoProctoring"),params:["context"]},{url:urlHelper.route("index","Monitor","taoProctoring"),params:["delivery","context"]},{url:urlHelper.route("index","Reporting","taoProctoring"),params:["delivery","session","context"]}];return _.defaults({start:function(){var toolbox=containerFactory(".header"),breadcrumbs=breadcrumbsFactory({renderTo:toolbox.getElement(),replace:!0,cls:"action-bar horizontal-action-bar"});appController.on("change.breadcrumbs",function(route){
var parsedRoute=urlHelper.parse(route),routes=function(route){var routes=[],parsed=urlHelper.parse(route);return _.forEach(knownRoutes,function(knownRoute){var url=urlHelper.parse(knownRoute.url),params={};if(parsed.path===url.path)return routes.push(route),!1;_.forEach(knownRoute.params,function(param){parsed.query[param]&&(params[param]=decodeURIComponent(parsed.query[param]))}),routes.push(urlHelper.build(knownRoute.url,params))}),routes}(route);void 0!==parsedRoute.query["link-type"]&&"direct"===parsedRoute.query["link-type"]?(delete parsedRoute.query["link-type"],window.location.replace(decodeURIComponent(urlHelper.build(parsedRoute.path,
parsedRoute.query)))):request(breadcrumbsUrl,{route:routes},"POST").then(function(data){breadcrumbs.update(data)}).catch(function(err){appController.onError(err)})}).apply("a",toolbox.getElement()).start()}},appController)}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("util/shortcut/registry")):"function"==typeof define&&define.amd?define("util/shortcut",["util/shortcut/registry"],factory):(global=global||self)["util/shortcut"]=factory(global["util/shortcut/registry"])}(this,function(shortcutRegistry){"use strict";return(shortcutRegistry=shortcutRegistry&&shortcutRegistry.hasOwnProperty(
"default")?shortcutRegistry.default:shortcutRegistry)(window,{propagate:!1,prevent:!0})}),define("taoProctoring/helper/status",["lodash","i18n"],function(_,__){"use strict";var _authorized="http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusAuthorized",_inprogress="http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusActive",_paused="http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusPaused",_completed="http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusFinished",_terminated="http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusTerminated",_status={inprogress:{code:_inprogress,
label:__("In Progress"),can:{authorize:__("already authorized"),pause:!0,terminate:!0,report:!0,print:__("not finished"),reactivate:__("not terminated"),time:!0},warning:{authorize:function(username,testId){return testId?__("Test %s had already been authorized.",testId):username?__("%s's test had already been authorized.",username):__("Test had already been authorized.")},print:function(username,testId){return testId?__("Test %s had not been finished.",testId):username?__("%s's test had not been finished.",username):__("Test had not been finished.")},reactivate:function(username,testId){return testId?__("Test %s must be terminated.",testId):username?__(
"%s's test must be terminated.",username):__("Test  must be terminated.")}}},authorized:{code:_authorized,label:__("Authorized but not started"),can:{authorize:__("already authorized"),terminate:!0,report:!0,pause:__("not started"),print:__("not finished"),reactivate:__("not terminated"),time:!0},warning:{authorize:function(username,testId){return testId?__("Test %s had already been authorized.",testId):username?__("%s's test had already been authorized.",username):__("Test had already been authorized.")},pause:function(username,testId){return testId?__("Test %s had not been started.",testId):username?__("%s's test had not been started.",username):__(
"Test had not been started.")},print:function(username,testId){return testId?__("Test %s had not been finished.",testId):username?__("%s's test had not been finished.",username):__("Test had not been finished.")},reactivate:function(username,testId){return testId?__("Test %s must be terminated.",testId):username?__("%s's test must be terminated.",username):__("Test  must be terminated.")}}},awaiting:{code:"http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusAwaiting",label:__("Awaiting"),can:{authorize:!0,pause:__("not in progress"),terminate:!0,reactivate:__("not terminated"),report:!0,print:__("not finished"),time:!0},warning:{
pause:function(username,testId){return testId?__("Test %s had not been in progress.",testId):username?__("%s's test had not been in progress.",username):__("Test had not been in progress.")},print:function(username,testId){return testId?__("Test %s had not been finished.",testId):username?__("%s's test had not been finished.",username):__("Test had not been finished.")},reactivate:function(username,testId){return testId?__("Test %s must be terminated.",testId):username?__("%s's test must be terminated.",username):__("Test  must be terminated.")}}},canceled:{code:"http://www.tao.lu/Ontologies/TAODelivery.rdf#DeliveryExecutionStatusCanceled",label:__(
"Canceled"),can:{authorize:__("canceled"),pause:__("canceled"),terminate:__("canceled"),reactivate:__("not terminated"),report:!0,print:__("canceled"),time:!0},warning:{authorize:function(username,testId){return testId?__("Test %s had been canceled.",testId):username?__("%s's test had been canceled.",username):__("Test had been canceled.")},pause:function(username,testId){return testId?__("Test %s had been canceled.",testId):username?__("%s's test had been canceled.",username):__("Test had been canceled.")},terminate:function(username,testId){return testId?__("Test %s had been canceled.",testId):username?__("%s's test had been canceled.",username):__(
"Test had been canceled.")},reactivate:function(username,testId){return testId?__("Test %s had been canceled.",testId):username?__("%s's test had been canceled.",username):__("Test had been canceled.")},print:function(username,testId){return testId?__("Test %s had been canceled.",testId):username?__("%s's test had been canceled.",username):__("Test had been canceled.")}}},completed:{code:_completed,label:__("Completed"),can:{authorize:__("completed"),pause:__("completed"),terminate:__("completed"),reactivate:__("not terminated"),report:!0,print:!0,time:!0},warning:{authorize:function(username,testId){return testId?__("Test %s had been completed.",testId
):username?__("%s's test had been completed.",username):__("Test had been completed.")},pause:function(username,testId){return testId?__("Test %s had been completed.",testId):username?__("%s's test had been completed.",username):__("Test had been completed.")},terminate:function(username,testId){return testId?__("Test %s had been completed.",testId):username?__("%s's test had been completed.",username):__("Test had been completed.")},reactivate:function(username,testId){return testId?__("Test %s must be terminated.",testId):username?__("%s's test must be terminated.",username):__("Test  must be terminated.")}}},paused:{code:_paused,label:__("Paused"),can:{
authorize:__("paused"),pause:__("already paused"),reactivate:__("not terminated"),terminate:!0,report:!0,print:__("not finished"),time:!0},warning:{authorize:function(username,testId){return testId?__("Test %s had been paused.",testId):username?__("%s's test had been paused.",username):__("Test had been paused.")},pause:function(username,testId){return testId?__("Test %s had already been paused.",testId):username?__("%s's test had already been paused.",username):__("Test had already been paused.")},print:function(username,testId){return testId?__("Test %s had not been finished.",testId):username?__("%s's test had not been finished.",username):__(
"Test had not been finished.")},reactivate:function(username,testId){return testId?__("Test %s must be terminated.",testId):username?__("%s's test must be terminated.",username):__("Test  must be terminated.")}}},terminated:{code:_terminated,label:__("Terminated"),can:{authorize:__("terminated"),pause:__("terminated"),terminate:__("already terminated"),report:!0,reactivate:!0,print:!0,time:!0},warning:{authorize:function(username,testId){return testId?__("Test %s had been terminated.",testId):username?__("%s's test had been terminated.",username):__("Test had been terminated.")},pause:function(username,testId){return testId?__("Test %s had been terminated.",
testId):username?__("%s's test had been terminated.",username):__("Test had been terminated.")},terminate:function(username,testId){return testId?__("Test %s had already been terminated.",testId):username?__("%s's test had already been terminated.",username):__("Test had alredy been terminated.")}}}};return{buildWarningMessage:function(action,selection,deniedResources){var warningAction,warningReason,isPlural=1<selection.length,warningOmission=__("...");switch(deniedResources=deniedResources||[{}],action){case"authorize":warningAction=__(isPlural?"Cannot authorize test sessions.":"Cannot authorize test session.");break;case"pause":warningAction=__(
isPlural?"Cannot pause test sessions.":"Cannot pause test session.");break;case"terminate":warningAction=__(isPlural?"Cannot terminate test sessions.":"Cannot terminate test session.");break;case"reactivate":warningAction=__(isPlural?"Cannot reactivate test sessions.":"Cannot reactivate test session.");break;case"report":warningAction=__(isPlural?"Cannot report test sessions.":"Cannot report test session.");break;case"print":warningAction=__(isPlural?"Cannot print test sessions.":"Cannot print test session.");break;case"time":warningAction=__(isPlural?"Cannot extend test sessions.":"Cannot extend test session.");break;default:warningAction=__(
"Cannot execute action.")}return warningReason=_(deniedResources).slice(0,2).map(function(deniedResource){return deniedResource.warning}).join(" "),2<deniedResources.length&&(warningReason+=warningOmission),warningAction+" "+warningReason},getStatuses:function(){return _.map(_status,function(el){return{code:el.code,label:el.label}})},getStatus:function(statusName){return _status[statusName]},getStatusByCode:function(statusCode){return _.find(_status,{code:statusCode})},verifyTestTaker:function(testTakerData,actionName){var formatted={id:testTakerData.id,label:testTakerData.firstname+" "+testTakerData.lastname},status=_status.getStatusByCode(
testTakerData.state.status);return status&&(formatted.allowed=!0===status.can[actionName],formatted.allowed||(formatted.reason=status.can[actionName])),formatted},STATUS_AUTHORIZED:_authorized,STATUS_INPROGRESS:_inprogress,STATUS_PAUSED:_paused,STATUS_COMPLETED:_completed,STATUS_TERMINATED:_terminated}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash")):"function"==typeof define&&define.amd?define("core/delegator",["lodash"],factory):(global=global||self)["core/delegator"]=factory(global._)}(this,function(_){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_;var defaults={
name:"provided",eventifier:!0},_slice=[].slice;return function(api,provider,config){var extendedConfig=_.defaults(config||{},defaults),eventifier=!!(extendedConfig.eventifier&&api&&api.trigger),context=extendedConfig.forward?provider:api,defaultProvider=_.isFunction(extendedConfig.defaultProvider)?extendedConfig.defaultProvider:_.noop,wrapper=_.isFunction(extendedConfig.wrapper)?extendedConfig.wrapper:null,name=extendedConfig.name;return extendedConfig.required&&(defaultProvider=null),function(fnName){var response,args;if(!provider)throw new Error("There is no "+name+" provider!");if(!_.isFunction(provider[fnName])&&!defaultProvider)throw new Error(
"There is no method called "+fnName+" in the "+name+" provider!");return args=_slice.call(arguments,1),response=(provider[fnName]||defaultProvider).apply(context,args),wrapper&&(response=wrapper(response)),eventifier&&api.trigger.apply(api,[fnName,response].concat(args)),response}}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash")):"function"==typeof define&&define.amd?define("core/providerRegistry",["lodash"],factory):(global=global||self)["core/providerRegistry"]=factory(global._)}(this,function(_){"use strict";return _=_&&_.hasOwnProperty("default")?_.default:_,function(target,
validator){var _providers={};return(target=target||{}).registerProvider=function(name,provider){var valid=!0;if(!_.isString(name)||name.length<=0)throw new TypeError("It is required to give a name to your provider.");if(!_.isPlainObject(provider)||!_.isFunction(provider.init))throw new TypeError("A provider is an object that contains at least an init function.");return(valid=validator&&_.isFunction(validator)?validator(provider):valid)&&(_providers[name]=provider),this},target.getProvider=function(providerName){var provider;if(!_providers||0===_.size(_providers))throw new Error("No provider registered");if(_.isString(providerName
)&&0<providerName.length?provider=_providers[providerName]:1===_.size(_providers)&&(providerName=_.keys(_providers)[0],provider=_providers[providerName]),!provider)throw new Error("No candidate found for the provider");return provider},target.getAvailableProviders=function(){return _.keys(_providers)},target.clearProviders=function(){return _providers={},this},target}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/delegator"),require("core/eventifier"),require("core/promise"),require("core/providerRegistry"),require("core/tokenHandler")
):"function"==typeof define&&define.amd?define("core/dataProvider/proxy",["lodash","core/delegator","core/eventifier","core/promise","core/providerRegistry","core/tokenHandler"],factory):(global=global||self)["core/dataProvider/proxy"]=factory(global._,global["core/delegator"],global["core/eventifier"],global["core/promise"],global["core/providerRegistry"],global["core/tokenHandler"])}(this,function(_,delegator,eventifier,Promise,providerRegistry,tokenHandlerFactory){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_,delegator=delegator&&delegator.hasOwnProperty("default")?delegator.default:delegator,eventifier=eventifier&&eventifier.hasOwnProperty(
"default")?eventifier.default:eventifier,Promise=Promise&&Promise.hasOwnProperty("default")?Promise.default:Promise,providerRegistry=providerRegistry&&providerRegistry.hasOwnProperty("default")?providerRegistry.default:providerRegistry,tokenHandlerFactory=tokenHandlerFactory&&tokenHandlerFactory.hasOwnProperty("default")?tokenHandlerFactory.default:tokenHandlerFactory;var _defaults={};return providerRegistry(function crudProxyFactory(proxyName,middlewares){var initConfig,proxyAdapter=crudProxyFactory.getProvider(proxyName),tokenHandler=tokenHandlerFactory(),extraParams={},initialized=!1,proxy=eventifier({init:function(config){return delegate("init",
initConfig=_.defaults({},config,_defaults)).then(function(){return initialized=!0,proxy})},destroy:function(){return delegate("destroy").then(function(){initialized=!1,initConfig=null,extraParams={}})},create:function(params){return delegate("create",getParams(params))},read:function(params){return delegate("read",getParams(params))},write:function(params){return delegate("write",getParams(params))},remove:function(params){return delegate("remove",getParams(params))},action:function(name,params){return delegate("action",name,getParams(params))},addExtraParams:function(params){return _.isPlainObject(params)&&_.merge(extraParams,params),this},
getTokenHandler:function(){return tokenHandler},getConfig:function(){return initConfig},getMiddlewares:function(){return middlewares},setMiddlewares:function(handler){return middlewares=handler,this}}),delegateProxy=delegator(proxy,proxyAdapter,{name:"proxy",wrapper:function(response){return Promise.resolve(response)}});function getParams(params){var mergedParams=_.merge({},params,extraParams);return extraParams={},mergedParams}function delegate(fnName){var request={command:fnName,params:Array.prototype.slice.call(arguments,1)};return initialized||"init"===fnName?delegateProxy.apply(null,arguments).then(function(data){return middlewares?middlewares.apply(
request,data):data}).catch(function(err){return proxy.trigger("error",err),Promise.reject(err)}):Promise.reject(new Error("Proxy is not properly initialized or has been destroyed!"))}return proxy})}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/dataProvider/request"),require("core/promise")):"function"==typeof define&&define.amd?define("core/dataProvider/proxy/ajax",["lodash","core/dataProvider/request","core/promise"],factory):(global=global||self)["core/dataProvider/proxy/ajax"]=factory(global._,global["core/dataProvider/request"],global["core/promise"])}(this,function(
_,request,Promise){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_,request=request&&request.hasOwnProperty("default")?request.default:request,Promise=Promise&&Promise.hasOwnProperty("default")?Promise.default:Promise;var _defaults={noCache:!0,noToken:!1,actions:{}};function rejectAction(type,action,params){return Promise.reject({success:!1,type:type,action:action,params:params})}return{name:"ajax",init:function(config){this.processRequest=function(action,params,method){var token,descriptor=config.actions[action],headers={},tokenHandler=this.getTokenHandler();return _.isString(descriptor)&&(descriptor={url:descriptor}),
descriptor&&descriptor.url?_.isFunction(descriptor.validate)&&!1===descriptor.validate(params)?rejectAction("invalid",action,params):(config.noCache&&(params=_.merge({_:(new Date).getTime()},params)),config.noToken||(token=tokenHandler.getToken())&&(headers["X-Auth-Token"]=token),request(descriptor.url,params,descriptor.method||method,headers).then(function(data){return data&&data.token&&tokenHandler.setToken(data.token),data}).catch(function(err){var t=err.response&&(err.response.token||err.response.data&&err.response.data.token);return t?tokenHandler.setToken(t):config.noToken||tokenHandler.setToken(token),Promise.reject(err)})):rejectAction(
"notimplemented",action,params)},_.defaults(config,_defaults)},destroy:function(){this.processRequest=null},create:function(params){return this.processRequest("create",params,"POST")},read:function(params){return this.processRequest("read",params,"GET")},write:function(params){return this.processRequest("write",params,"POST")},remove:function(params){return this.processRequest("remove",params,"GET")},action:function(actionName,params){return this.processRequest(actionName,params,"POST")}}}),define("taoProctoring/component/proxy",["core/dataProvider/proxy","core/dataProvider/proxy/ajax"],function(proxyFactory,ajaxProxy){"use strict"
;return proxyFactory.registerProvider("ajax",ajaxProxy)}),define("tpl!taoProctoring/templates/delivery/index",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<div class="content">\n    ',!(stack1=helpers.if.call(depth0,depth0&&depth0.title,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,helper,buffer="";return buffer+="<h1>",stack1=(helper=helpers.title)?helper.call(depth0,{hash:{},
data:data}):typeof(helper=depth0&&depth0.title)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</h1>"},data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+='\n    <div class="panel"></div>\n    <div class="list clearfix"></div>\n</div>'})}),define("tpl!taoProctoring/templates/delivery/listBoxActions",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var helper,options,buffer="",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing
;return buffer+='<span class="listbox-actions">\n    <span class="action pause" data-delivery="',buffer+=escapeExpression((helper=helpers.id)?helper.call(depth0,{hash:{},data:data}):"function"==typeof(helper=depth0&&depth0.id)?helper.call(depth0,{hash:{},data:data}):helper)+'">\n        <span class="icon-pause"></span>'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Pause",options):helperMissing.call(depth0,"__","Pause",options)))+'\n    </span>\n    <span class="action play">\n        <span class="icon-play"></span>'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__
)?helper.call(depth0,"Monitor",options):helperMissing.call(depth0,"__","Monitor",options)))+"\n    </span>\n</span>"})}),define("tpl!taoProctoring/templates/delivery/listBoxStats",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],data=data||{};var stack1,helper,buffer="",helperMissing=(helpers=this.merge(helpers,Handlebars.helpers)).helperMissing,escapeExpression=this.escapeExpression,functionType="function";return!(stack1=helpers.if.call(depth0,depth0&&depth0.showProperties,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,helper,options,buffer=""
;return buffer+='\n<ul class="plain listbox-properties">\n    <li>\n        <label>'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Start",options):helperMissing.call(depth0,"__","Start",options)))+"</label>: ",stack1=(helper=helpers.periodStart)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.periodStart)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"\n    </li>\n    <li>\n        <label>"+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"End",options):helperMissing.call(
depth0,"__","End",options)))+"</label>: ",stack1=(helper=helpers.periodEnd)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.periodEnd)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"\n    </li>\n</ul>\n"},data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+='\n<p class="listbox-stats">\n    <span class="icon-lock"></span><span class="number">',stack1=(helper=helpers.locked)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.locked)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1
)+'</span>\n    <span class="icon-play"></span><span class="number">',stack1=(helper=helpers.inProgress)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.inProgress)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'</span>\n    <span class="icon-pause"></span><span class="number">',stack1=(helper=helpers.paused)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.paused)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</span>\n</p>"})}),function(global,factory){
"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("module"),require("moment")):"function"==typeof define&&define.amd?define("util/locale",["module","moment"],factory):(global=global||self)["util/locale"]=factory(global.module,global.moment)}(this,function(module,moment){"use strict";module=module&&module.hasOwnProperty("default")?module.default:module,moment=moment&&moment.hasOwnProperty("default")?moment.default:moment;var configuration=module.config();return{getConfig:function(){return configuration},setConfig:function(config){configuration=config||{}},getDecimalSeparator:function(){return this.getConfig()&&this.getConfig(
).decimalSeparator?this.getConfig().decimalSeparator:"."},getThousandsSeparator:function(){return this.getConfig()&&this.getConfig().thousandsSeparator?this.getConfig().thousandsSeparator:""},getDateTimeFormat:function(){return this.getConfig()&&this.getConfig().dateTimeFormat?this.getConfig().dateTimeFormat:"DD/MM/YYYY HH:mm:ss"},parseFloat:function(numStr){var thousandsSeparator=this.getThousandsSeparator(),decimalSeparator=this.getDecimalSeparator();return thousandsSeparator.length&&(numStr=numStr.replace(new RegExp("\\"+thousandsSeparator,"g"),"")),"."!==decimalSeparator&&(numStr=numStr.replace(new RegExp("\\.","g"),"_").replace(new RegExp(
"\\"+decimalSeparator,"g"),".")),parseFloat(numStr)},parseInt:function(number,numericBase){var thousandsSeparator=this.getThousandsSeparator();return thousandsSeparator.length&&(number=number.replace(new RegExp("\\"+thousandsSeparator,"g"),"")),parseInt(number,numericBase)},formatDateTime:function(timestamp){return moment(timestamp,"X").format(this.getDateTimeFormat())}}}),define("taoProctoring/controller/Delivery/index",["jquery","lodash","i18n","module","core/promise","controller/app","util/url","layout/loading-bar","ui/listbox","util/encode","ui/feedback","ui/bulkActionPopup","ui/cascadingComboBox","ui/container","taoProctoring/helper/status",
"taoProctoring/component/proxy","tpl!taoProctoring/templates/delivery/index","tpl!taoProctoring/templates/delivery/listBoxActions","tpl!taoProctoring/templates/delivery/listBoxStats","util/locale"],function($,_,__,module,Promise,appController,urlHelper,loadingBar,listBoxFactory,encode,feedback,bulkActionPopup,cascadingComboBox,containerFactory,_status,proxyFactory,indexTpl,actionsTpl,statsTpl,locale){"use strict";var serviceUrl=urlHelper.route("deliveries","DeliverySelection","taoProctoring"),pauseUrl=urlHelper.route("pauseExecutions","Monitor","taoProctoring"),sessionsUrl=urlHelper.route("deliveryExecutions","Monitor","taoProctoring")
;function validateParams(params){return _.isPlainObject(params)&&(_.isUndefined(params.delivery)||!_.isEmpty(params.delivery))&&(_.isUndefined(params.execution)||!_.isEmpty(params.execution))&&(_.isUndefined(params.reason)||!_.isEmpty(params.reason))}return loadingBar.start(),{start:function(){var deliveries,categories,proxyDeliveries,proxySessions,title=__("Sessions"),context=module.config().context,container=containerFactory(".container").changeScope(".delivery-index").write(indexTpl({title:title})),listBox=listBoxFactory({title:title,textEmpty:__("No sessions available"),textNumber:__("Available"),textLoading:__("Loading"),renderTo:container.find(
".content"),replace:!0,list:[],width:12,countRenderer:function(count){return count-1}});appController.on("change.deliveryIndex",function(){appController.off(".deliveryIndex"),listBox.destroy(),container.destroy()}),Promise.all([proxyFactory("ajax").init({actions:{read:serviceUrl}}).then(function(proxy){proxyDeliveries=proxy}),proxyFactory("ajax").init({actions:{read:{url:sessionsUrl,validate:validateParams},pause:{url:pauseUrl,validate:validateParams}}}).then(function(proxy){proxySessions=proxy})]).then(function(){function getDeliveryLabel(id){return deliveries[id]&&deliveries[id].label}function refresh(){return loadingBar.start(),listBox.setLoading(!0),
proxyDeliveries.read({context:context}).then(function(data){categories=data.categories,deliveries=_.transform(data.list,function(result,delivery){var props=delivery.properties,tplData={locked:delivery.stats.awaitingApproval,inProgress:delivery.stats.inProgress,paused:delivery.stats.paused};props&&props.periodStart&&props.periodEnd&&(tplData.showProperties=!0,tplData.periodStart=props.periodStart,tplData.periodEnd=props.periodEnd,delivery.cls="has-properties-displayed"),delivery.html=actionsTpl({id:delivery.id}),delivery.content=statsTpl(tplData),delivery.cls=((delivery.cls||"")+" router").trim(),result[delivery.id]=delivery},{}),listBox.update(data.list),
loadingBar.stop()}).catch(function(err){appController.onError(err)})}function pause(deliveryId,selection,deliveryExecutions){return new Promise(function(resolve,reject){bulkActionPopup({renderTo:container.getElement(),actionName:__("Pause Session"),reason:!0,resourceType:"session",categoriesSelector:cascadingComboBox({categoriesDefinitions:categories.pause.categoriesDefinitions,categories:categories.pause.categories}),allowedResources:function(sessions){return _.map(sessions,function(session){return{id:session.id,label:session.delivery.label+" ["+locale.formatDateTime(session.start_time)+"]"}})}(selection)}).on("cancel",resolve).on("ok",function(reason){
proxySessions.action("pause",{delivery:deliveryId,execution:_.pluck(selection,"id"),reason:reason}).then(function(){feedback().success("Selected deliveries successfully paused"),refresh().then(resolve).catch(reject)}).catch(function(err){err.response?(feedback().warning(__("Something went wrong ...")+"<br>"+function(response,deliveryExecutions){var messageContext,unprocessed,responseData;return messageContext="",response&&(responseData=response.data,unprocessed={},responseData&&_.forEach(responseData.unprocessed,function(id){var execution=deliveryExecutions[id],uri=execution&&execution.delivery&&execution.delivery.uri;uri&&(unprocessed[uri]=(
unprocessed[uri]||0)+1)}),(unprocessed=_.map(unprocessed,function(count,uri){return 1<count?__("%d sessions of the delivery %s have not been paused",count,getDeliveryLabel(uri)):__("A session of the delivery %s have not been paused",getDeliveryLabel(uri))})).length&&(messageContext+="<br>"+unprocessed.join("<br>")),response.error&&(messageContext+="<br>"+encode.html(response.error))),messageContext}(err.response,deliveryExecutions),{encodeHtml:!1}),resolve()):reject(err)})})})}listBox.getElement().on("click",".pause",function(e){var deliveryId=$(this).data("delivery");loadingBar.start(),e.stopPropagation(),e.preventDefault(),proxySessions.read({
delivery:deliveryId,context:context}).then(function(sessions){var inProgressExecs,deliveryExecutions={};if((inProgressExecs=_.filter(sessions,function(session){return(deliveryExecutions[session.id]=session).state&&session.state.status===_status.getStatus("inprogress").code})).length)return pause(deliveryId,inProgressExecs,deliveryExecutions);feedback().info(__("There is no delivery in progress"))}).catch(function(err){appController.onError(err)}).then(function(){loadingBar.stop()})}),refresh()}).catch(function(err){appController.onError(err),loadingBar.stop()})}}}),define("taoProctoring/component/breadcrumbs",["ui/breadcrumbs"],function(breadcrumbs){
"use strict";return function($container,crumbs){return breadcrumbs({breadcrumbs:crumbs,renderTo:$container.find(".header"),replace:!0,cls:"action-bar horizontal-action-bar"})}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("util/httpErrorParser",factory):(global=global||self)["util/httpErrorParser"]=factory()}(this,function(){"use strict";return{parse:function(xhr,options,errorThrown){var msg,json,error;try{msg=(json=JSON.parse(xhr.responseText)).message?json.message:errorThrown}catch(e){msg=errorThrown}return(error=new Error(msg)).response=xhr,
error.code=xhr.status,error.errorThrown=errorThrown,error}}}),define("taoProctoring/controller/Delivery/manage",["jquery","i18n","helpers","layout/loading-bar","util/encode","ui/feedback","ui/dialog","taoProctoring/component/breadcrumbs","ui/datatable"],function($,__,helpers,loadingBar,encode,feedback,dialog,breadcrumbsFactory){"use strict";return loadingBar.start(),{start:function(){function remove(selection){!function(url,selection,message){selection&&selection.length&&(loadingBar.start(),$.ajax({url:url,data:{testtaker:selection},dataType:"json",type:"POST",error:function(){loadingBar.stop()}}).done(function(response){loadingBar.stop(),
response&&response.success?(message&&feedback().success(message),$list.datatable("refresh")):feedback().error(__("Something went wrong ...")+"<br>"+encode.html(response.error),{encodeHtml:!1})}))}(removeUrl,selection,__("Test takers have been removed"))}var $container=$(".delivery-manager"),$list=$container.find(".list"),crumbs=$container.data("breadcrumbs"),dataset=$container.data("set"),deliveryId=$container.data("delivery"),testCenterId=$container.data("testcenter"),assignUrl=helpers._url("testTakers","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),removeUrl=helpers._url("removeTestTakers","Delivery","taoProctoring",{
delivery:deliveryId,testCenter:testCenterId}),serviceUrl=helpers._url("deliveryTestTakers","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),monitoringUrl=helpers._url("monitoring","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId});breadcrumbsFactory($container,crumbs);$list.on("query.datatable",function(){loadingBar.start()}).on("load.datatable",function(){loadingBar.stop()}).datatable({url:serviceUrl,status:{empty:__("No assigned test takers"),available:__("Assigned test takers"),loading:__("Loading")},tools:[{id:"refresh",icon:"reset",title:__("Refresh the page"),label:__("Refresh"),action:function(){
$list.datatable("refresh")}},{id:"back",icon:"preview",title:__("Return to the session monitoring"),label:__("Monitoring"),action:function(){window.location.href=monitoringUrl}},{id:"assign",icon:"add",title:__("Assign more test takers to this session"),label:__("Add test takers"),action:function(){window.location.href=assignUrl}},{id:"remove",icon:"remove",title:__("Remove the selected test takers from the session"),label:__("Remove"),massAction:!0,action:function(selection){dialog({message:__("The test takers will be removed from this session. Continue ?"),autoRender:!0,autoDestroy:!0,onOkBtn:function(){remove(selection)}})}}],actions:[{id:"remove",
icon:"remove",title:__("Remove the test taker from the session"),action:function(id){dialog({autoRender:!0,autoDestroy:!0,message:__("The test taker will be removed from this session. Continue ?"),onOkBtn:function(){remove([id])}})}}],selectable:!0,model:[{id:"firstname",label:__("First name")},{id:"lastname",label:__("Last name")},{id:"identifier",label:__("Identifier")},{id:"status",label:__("Status")}]},dataset)}}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("lodash"),require("core/promise"),require("core/eventifier")):"function"==typeof define&&define.amd?define("core/polling",["lodash",
"core/promise","core/eventifier"],factory):(global=global||self)["core/polling"]=factory(global._,global["core/promise"],global["core/eventifier"])}(this,function(_,Promise,eventifier){"use strict";_=_&&_.hasOwnProperty("default")?_.default:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise.default:Promise,eventifier=eventifier&&eventifier.hasOwnProperty("default")?eventifier.default:eventifier;return function(config,argument_1){var timer,promise,interval,max,iter,action,context,autoStart,state={},startTimer=function(){timer=setTimeout(iteration,interval),state.stopped=!1,state.pending=!0},stopTimer=function(){clearTimeout(timer),timer=null,
state.stopped=!0,state.pending=!1},iteration=function(){max&&max<=iter?polling.stop():(iter=(iter||0)+1,state.processing=!0,state.pending=!1,polling.trigger("call"),action.call(context,polling),promise||state.stopped||(state.processing=!1,startTimer()))},polling={async:function(){var resolver={};return(promise=new Promise(function(resolve,reject){resolver.resolve=resolve,resolver.reject=reject})).then(function(){promise=null,state.processing=!1,state.stopped||startTimer(),polling.trigger("resolved")}).catch(function(){promise=null,state.processing=!1,polling.stop(),polling.trigger("rejected")}),polling.trigger("async",resolver),resolver},next:function(){
var _next;return state.stopped&&(iter=0),stopTimer(),max&&max<=iter||(state.stopped=!1,promise?(_next=this.next.bind(this),promise.then(_next).catch(_next)):(this.trigger("next"),iteration())),this},start:function(){return timer||(iter=0,startTimer(),this.trigger("start")),this},stop:function(){return stopTimer(),this.trigger("stop"),this},setInterval:function(value){return interval=Math.abs(parseInt(value,10)||6e4),this.trigger("setinterval",interval),this},getInterval:function(){return interval},setAction:function(fn){return action=fn,this.trigger("setaction",action),this},getAction:function(){return action},setContext:function(ctx){
return context=ctx||this,this.trigger("setcontext",ctx),this},getContext:function(){return context},setMax:function(value){return max=Math.abs(parseInt(value,10)||0),this},getMax:function(){return max},getIteration:function(){return iter||0},is:function(stateName){return!!state[stateName]}};return eventifier(polling),interval=6e4,context=polling,action=null,autoStart=!(state.stopped=!0),iter=0,_.isFunction(config)&&(polling.setAction(config),config=null),_.isObject(config)&&(polling.setAction(config.action),polling.setInterval(config.interval||argument_1),polling.setContext(config.context),polling.setMax(config.max),autoStart=!!config.autoStart),
autoStart&&polling.start(),polling}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("core/timer",factory):(global=global||self)["core/timer"]=factory()}(this,function(){"use strict";return function(config){var initConfig=config||{},begin=now(),last=begin,duration=initConfig.startDuration||0,state={},timer={start:function(startDuration){return begin=now(),last=begin,duration=startDuration||0,state.running=!0,state.started=!0,this},tick:function(){var elapsed,timestamp=now();return state.running&&(elapsed=timestamp-last,last=timestamp),elapsed},pause:function(
){return state.running&&(duration+=now()-begin,state.running=!1),this},resume:function(){return state.running||(begin=now(),last=begin,state.started=!0,state.running=!0),this},stop:function(){return state.running&&(duration+=now()-begin),state.running=!1,state.started=!1,this},getDuration:function(){return state.running?duration+(now()-begin):duration},is:function(stateName){return!!state[stateName]},add:function(time){return time=parseFloat(time),duration+=time,last-=time,this},sub:function(time){return time=parseFloat(time),duration-=time,last+=time,this}};function now(){return window.performance.now()}return!1===initConfig.autoStart||timer.start(
initConfig.startDuration),timer}}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("moment")):"function"==typeof define&&define.amd?define("core/encoder/time",["moment"],factory):(global=global||self)["core/encoder/time"]=factory(global.moment)}(this,function(moment){"use strict";moment=moment&&moment.hasOwnProperty("default")?moment.default:moment;return{encode:function(modelValue){var seconds=parseInt(modelValue,10);isNaN(seconds)&&(seconds=0);var time=moment.duration(seconds,"seconds");return(10<=time.get("hours")?time.get("hours"):"0"+time.get("hours"))+":"+(10<=time.get("minutes")?time.get(
"minutes"):"0"+time.get("minutes"))+":"+(10<=time.get("seconds")?time.get("seconds"):"0"+time.get("seconds"))},decode:function(nodeValue){var time=moment(nodeValue,"HH:mm:ss");return time.seconds()+60*time.minutes()+3600*time.hours()}}}),define("taoProctoring/component/extraTime/encoder",["core/format","core/encoder/time"],function(format,timeEncoder){"use strict";return function(extraTime,consumedTime,pattern,unit){var encoded="";return pattern=pattern||"%s",unit=unit||1,extraTime&&(encoded=" +"+(encoded=consumedTime?timeEncoder.encode(Math.min(consumedTime,extraTime))+"/"+timeEncoder.encode(extraTime):"HH:mm:ss"===pattern?timeEncoder.encode(extraTime
):format(pattern,extraTime/unit))),encoded}}),define("tpl!taoProctoring/component/extraTime/extraTime",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,helper,options,buffer="",functionType="function",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing;function program2(depth0,data){var stack1,helper,buffer="";return buffer+='\n            <li data-resource="',stack1=(helper=helpers.id)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.id
)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'">\n                <span class="resource-label">',stack1=(helper=helpers.label)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.label)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</span>\n                ",!(stack1=helpers.if.call(depth0,depth0&&depth0.remainingStr,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+="\n                ",!(stack1=helpers.if.call(depth0,depth0&&depth0.extraTimeStr,{hash:{},inverse:self.noop,
fn:self.program(5,program5,data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+="\n            </li>\n            "}function program3(depth0,data){var stack1,helper,buffer="";return buffer+='<span class="remaining">',stack1=(helper=helpers.remainingStr)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.remainingStr)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</span>"}function program5(depth0,data){var stack1,helper,buffer="";return buffer+='<span class="time">(',stack1=(helper=helpers.extraTimeStr)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.extraTimeStr
)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+")</span>"}function program7(depth0,data){var stack1,helper,options,buffer="";return buffer+="\n    <p>"+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"However, the action will not be applied to the following sessions",options):helperMissing.call(depth0,"__","However, the action will not be applied to the following sessions",options)))+':</p>\n    <ul class="plain no-applicables">\n        ',!(stack1=helpers.each.call(depth0,depth0&&depth0.deniedResources,{hash:{},inverse:self.noop,fn:self.program(8,
program8,data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+="\n    </ul>\n    "}function program8(depth0,data){var stack1,helper,buffer="";return buffer+='\n        <li data-resource="',stack1=(helper=helpers.id)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.id)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'">\n            <span class="resource-label">',stack1=(helper=helpers.label)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.label)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1
)+'</span>\n            <span class="reason">(',stack1=(helper=helpers.reason)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.reason)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+")</span>\n        </li>\n        "}return buffer+='<div class="bulk-action-popup">\n    <h2 class="title">'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Action",options):helperMissing.call(depth0,"__","Action",options)))+": ",stack1=(helper=helpers.actionName)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.actionName
)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</h2>\n\n    ",!(stack1=helpers.if.call(depth0,null==(stack1=depth0&&depth0.allowedResources)||!1===stack1?stack1:stack1.length,{hash:{},inverse:self.program(10,function(depth0,data){var helper,options,buffer="";return buffer+="\n    <p>"+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"The action cannot be applied, no eligible sessions found",options):helperMissing.call(depth0,"__","The action cannot be applied, no eligible sessions found",options)))+"</p>\n    "},data),fn:self.program(1,function(depth0,
data){var stack1,helper,options,buffer="";return buffer+='\n    <div class="multiple">\n        <p>'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"The action will be applied to the following session",options):helperMissing.call(depth0,"__","The action will be applied to the following session",options)))+':</p>\n        <ul class="plain applicables">\n            ',!(stack1=helpers.each.call(depth0,depth0&&depth0.allowedResources,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+="\n        </ul>\n    </div>\n\n    ",!(stack1=helpers.if.call(
depth0,null==(stack1=depth0&&depth0.deniedResources)||!1===stack1?stack1:stack1.length,{hash:{},inverse:self.noop,fn:self.program(7,program7,data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+="\n\n    "},data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+='\n\n    <div class="form">\n        <p>\n            <label for="input-extra-time">'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Extra time",options):helperMissing.call(depth0,"__","Extra time",options)))+':</label>\n            <input type="text" id="input-extra-time" data-control="time" value="',stack1=(helper=helpers.time
)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.time)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'" maxlength="4" size="4" />\n            <label for="input-extra-time">'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"minutes",options):helperMissing.call(depth0,"__","minutes",options)))+"</label>\n        </p>\n    </div>\n    <p>\n        <strong>"+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Note",options):helperMissing.call(depth0,"__","Note",options))
)+":</strong>\n        <em>"+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"the already granted time will be replaced by the new value",options):helperMissing.call(depth0,"__","the already granted time will be replaced by the new value",options)))+'</em>\n    </p>\n\n    <div class="actions">\n        <div class="feedback-error small hidden">'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"The extra time must be a number",options):helperMissing.call(depth0,"__","The extra time must be a number",options))
)+'</div>\n        <button class="btn btn-info small action done" data-control="done">'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"OK",options):helperMissing.call(depth0,"__","OK",options)))+'</button>\n        <a href="#" class="btn action cancel" title="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"cancel the action",options):helperMissing.call(depth0,"__","cancel the action",options)))+'" data-control="cancel">'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"cancel",options
):helperMissing.call(depth0,"__","cancel",options)))+"</a>\n    </div>\n\n</div>"})}),define("taoProctoring/component/extraTime/extraTime",["jquery","lodash","i18n","core/encoder/time","ui/component","ui/hider","taoProctoring/component/extraTime/encoder","tpl!taoProctoring/component/extraTime/extraTime","ui/modal"],function($,_,__,timeEncoder,component,hider,encodeExtraTime,extraTimeTpl){"use strict";var _defaults={unit:60,deniedResources:[]};return function(config){var initConfig=_.defaults(config||{},_defaults),timeUnit=initConfig.unit||_defaults.unit;return _.forEach(initConfig.allowedResources,function(resource){var remaining=parseFloat(
resource.remaining)||0,extraTime=parseFloat(resource.extraTime),consumedTime=parseFloat(resource.consumedTime);remaining&&(resource.remainingStr=timeEncoder.encode(remaining)),resource.extraTimeStr=encodeExtraTime(extraTime,consumedTime,__("%s minutes more"),timeUnit)}),component().setTemplate(extraTimeTpl).on("render",function(){var self=this,$cmp=this.getElement(),$time=$cmp.find('[data-control="time"]'),$error=$cmp.find(".feedback-error"),$ok=$cmp.find('[data-control="done"]');function checkInputError(){var value=$time.val().trim(),time=Number(value),error=isNaN(time)||time!==parseFloat(value);return error?(hider.show($error),$ok.attr("disabled",!0),
focus()):($ok.removeAttr("disabled"),hider.hide($error)),error}function submit(){checkInputError()||(self.trigger("ok",parseFloat($time.val())*timeUnit),$cmp.modal("close"))}function focus(){$time.focus().select()}$time.val(_.reduce(initConfig.allowedResources,function(time,testTaker){return Math.max(time,testTaker&&testTaker.extraTime||0)},0)/timeUnit),$cmp.addClass("modal").on("closed.modal",function(){self.destroy()}).on("change",$time,function(){checkInputError()}).on("keyup",function(event){13===event.keyCode?submit():checkInputError()}).on("click",".action",function(event){var control=$(event.target).closest(".action").data("control")
;event.preventDefault(),"done"===control?submit():(self.trigger("cancel"),$cmp.modal("close"))}).modal({width:800}),focus()}).on("destroy",function(){this.getElement().removeClass("modal").modal("destroy")}).init(initConfig)}}),define("tpl!taoProctoring/templates/delivery/monitoring",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<div class="content">\n    ',!(stack1=helpers.if.call(depth0,depth0&&depth0.title,{
hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,helper,buffer="";return buffer+="<h1>",stack1=(helper=helpers.title)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.title)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</h1>"},data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+='\n    <div class="panel"></div>\n    <div class="list clearfix"></div>\n</div>'})}),define("tpl!taoProctoring/templates/delivery/deliveryLink",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],
data=data||{};var stack1,helper,buffer="";return buffer+='<span class="elipsis" title="',!(stack1=(helper=(helpers=this.merge(helpers,Handlebars.helpers)).label)?helper.call(depth0,{hash:{},data:data}):"function"==typeof(helper=depth0&&depth0.label)?helper.call(depth0,{hash:{},data:data}):helper)&&0!==stack1||(buffer+=stack1),buffer+='">',!(stack1=(helper=helpers.label)?helper.call(depth0,{hash:{},data:data}):"function"==typeof(helper=depth0&&depth0.label)?helper.call(depth0,{hash:{},data:data}):helper)&&0!==stack1||(buffer+=stack1),buffer+="</span>"})}),define("tpl!taoProctoring/templates/delivery/statusFilter",["handlebars"],function(hb){
return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<select name="filter[status]" class="filter status select2">\n    <option value="" selected></option>\n    ',!(stack1=helpers.each.call(depth0,depth0&&depth0.statuses,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,helper,buffer="";return buffer+='\n    <option value="',stack1=(helper=helpers.code)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.code
)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'">',stack1=(helper=helpers.label)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.label)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</option>\n    "},data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+="\n</select>"})}),define("tpl!taoProctoring/templates/delivery/approximatedTimer",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var stack1,
self=this,functionType="function",escapeExpression=this.escapeExpression;function program2(depth0,data){return"countDown"}return(stack1=helpers.if.call(depth0,depth0&&depth0.timer,{hash:{},inverse:self.noop,fn:self.program(1,function(depth0,data){var stack1,helper,buffer="";return buffer+='\n<span class="procotor-timer_time ',!(stack1=helpers.if.call(depth0,depth0&&depth0.countDown,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+='" data-remaining="',stack1=(helper=helpers.remaining)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.remaining)===functionType?helper.call(depth0,{
hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'">',stack1=(helper=helpers.timer)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.timer)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</span>\n"},data),data:data}))||0===stack1?stack1:""})}),define("taoProctoring/controller/Delivery/monitoring",["jquery","lodash","i18n","module","controller/app","core/polling","core/timer","util/url","layout/loading-bar","core/encoder/time","util/encode","ui/feedback","ui/dialog","ui/bulkActionPopup","ui/cascadingComboBox","ui/container","ui/datetime/picker","taoProctoring/component/proxy",
"taoProctoring/component/extraTime/extraTime","taoProctoring/component/extraTime/encoder","taoProctoring/helper/status","tpl!taoProctoring/templates/delivery/monitoring","tpl!taoProctoring/templates/delivery/deliveryLink","tpl!taoProctoring/templates/delivery/statusFilter","moment","util/locale","tpl!taoProctoring/templates/delivery/approximatedTimer","ui/datatable","select2"],function($,_,__,module,appController,pollingFactory,timerFactory,urlHelper,loadingBar,timeEncoder,encode,feedback,dialog,bulkActionPopup,cascadingComboBox,containerFactory,dateTimePicker,proxyFactory,extraTimePopup,encodeExtraTime,_status,monitoringTpl,deliveryLinkTpl,statusFilterTpl,
moment,locale,approximatedTimerTpl){"use strict";var terminateUrl=urlHelper.route("terminateExecutions","Monitor","taoProctoring"),reactivateUrl=urlHelper.route("reactivateExecutions","MonitorProctorAdministrator","taoProctoring"),pauseUrl=urlHelper.route("pauseExecutions","Monitor","taoProctoring"),authorizeUrl=urlHelper.route("authoriseExecutions","Monitor","taoProctoring"),extraTimeUrl=urlHelper.route("extraTime","Monitor","taoProctoring"),reportUrl=urlHelper.route("reportExecutions","Monitor","taoProctoring"),serviceUrl=urlHelper.route("monitor","Monitor","taoProctoring"),executionsUrl=urlHelper.route("deliveryExecutions","Monitor","taoProctoring"),
historyUrl=urlHelper.route("index","Reporting","taoProctoring");function validateParams(params){return _.isPlainObject(params)&&(_.isUndefined(params.delivery)||!_.isEmpty(params.delivery))&&(_.isUndefined(params.testCenter)||!_.isEmpty(params.testCenter))&&!_.isEmpty(params.execution)}return loadingBar.start(),{start:function(){var dataset,extraFields,categories,timeHandlingButton,allowedConnectivity,printReportButton,printReportUrl,hasAccessToReactivate,actionButtons,actionList,label,startDatePicker,container=containerFactory().changeScope(".delivery-monitoring").write(monitoringTpl()),$content=container.find(".content"),$list=container.find(".list"),
pageParams=module.config(),deliveryId=pageParams.delivery,context=pageParams.context,defaultTag=pageParams.defaultTag,defaultAvailableLabel=__("Current sessions"),tools=[],model=[],highlightRows=[],serviceParams={},sessionsHistoryUrl=historyUrl,timer=timerFactory({autoStart:!1}),polling=pollingFactory({action:function(){var elapsed=timer.tick()/1e3,timers=$(".procotor-timer_time.countDown");_.forEach(timers,function(timerItem){var remaining=$(timerItem).data("remaining");0<remaining&&(remaining-=elapsed,$(timerItem).html(timeEncoder.encode(Math.round(remaining))),$(timerItem).data("remaining",remaining))})},interval:1e3,autoStart:!1});appController.on(
"change.deliveryMonitoring",function(){appController.off(".deliveryMonitoring"),container.destroy()}),proxyFactory("ajax").init({actions:{read:serviceUrl,authorize:{url:authorizeUrl,validate:validateParams},pause:{url:pauseUrl,validate:validateParams},terminate:{url:terminateUrl,validate:validateParams},reactivate:{url:reactivateUrl,validate:validateParams},report:{url:reportUrl,validate:validateParams},extraTime:{url:extraTimeUrl,validate:validateParams}}}).then(function(proxyExecutions){function request(action,selection,data,message){var params;selection&&selection.length&&(loadingBar.start(),params=_.merge({execution:selection},data),deliveryId&&(
params.delivery=deliveryId),context&&(params.testCenter=context),proxyExecutions.action(action,params).then(function(){message&&feedback().success(message),$list.datatable("refresh")}).catch(function(err){var responseData,unprocessed,messageContext="";err.response&&(responseData=err.response.data,(unprocessed=_.map(responseData.unprocessed,function(msg,id){var execution;return id||(id=msg,msg=null),msg||((execution=getExecutionData(id))?__("Session %s - %s has not been processed",execution.delivery.label,execution.start_time):void 0)})).length&&(messageContext+="<br>"+unprocessed.join("<br>")),responseData.error&&(messageContext+="<br>"+encode.html(
responseData.error))),appController.onError(err),feedback().error(__("Something went wrong ...")+"<br>"+messageContext,{encodeHtml:!1})}).then(function(){loadingBar.stop()}))}function authorize(selection){execBulkAction("authorize",__("Authorize Session"),selection,function(sel,reason){request("authorize",sel,{reason:reason},__("Sessions authorized"))})}function pause(selection){execBulkAction("pause",__("Pause Session"),selection,function(sel,reason){request("pause",sel,{reason:reason},__("Sessions paused"))})}function terminate(selection){execBulkAction("terminate",__("Terminate Session"),selection,function(sel,reason){request("terminate",sel,{
reason:reason},__("Sessions terminated"))})}function report(selection){execBulkAction("report",__("Report Irregularity"),selection,function(sel,reason){request("report",sel,{reason:reason},__("Sessions reported"))})}function terminateOrReactivateAndIrregularity(selection){var delivery=getExecutionData(selection),buttons=[];hasAccessToReactivate&&canDo("reactivate",delivery.state)?buttons.push({id:"reactivate",type:"error",label:__("Reactivate session"),icon:"play",close:!0,action:function(){!function(selection){execBulkAction("reactivate",__("Reactivate Session"),selection,function(sel,reason){request("reactivate",sel,{reason:reason},__(
"Sessions reactivated"))})}(selection)}}):canDo("terminate",delivery.state)&&buttons.push({id:"terminate",type:"error",label:__("Terminate session"),icon:"stop",close:!0,action:function(){terminate(selection)}}),buttons.push({id:"irregularity",type:"info",label:__("Report irregularity"),icon:"delivery-small",close:!0,action:function(){report(selection)}}),dialog({message:__("Please, make your selection"),autoRender:!0,autoDestroy:!0,buttons:buttons})}function showHistory(selection){var monitoringRoute=window.location+"",urlParams={session:selection};context&&(urlParams.context=context),deliveryId&&(urlParams.delivery=deliveryId),appController.getRouter(
).redirect(urlHelper.build(sessionsHistoryUrl,urlParams)).then(function(){appController.trigger("set-referrer",monitoringRoute)}).catch(function(err){appController.onError(err)})}function printReport(selection){execBulkAction("print",__("Print Score"),selection,function(sel){var params={id:sel};context&&(params.context=context);var url=urlHelper.route(printReportUrl.action,printReportUrl.controller,printReportUrl.extension,params);window.open(url,"printReport"+JSON.stringify(sel))})}function timeHandling(selection){var _selection=_.isArray(selection)?selection:[selection],config=_.merge(listSessions("time",_selection),{renderTo:$content,actionName:__(
"Grant Extra Time"),unit:60});extraTimePopup(config).on("ok",function(time){request("extraTime",_selection,{time:time},__("Extra time granted"))})}function canDo(what,state){var status;return!(!state||!state.status)&&((status=_status.getStatusByCode(state.status))&&!0===status.can[what])}function getExecutionData(uri){return _.find(dataset.data,{id:uri})}function listSessions(actionName,selection){var allowedDeliveries=[],forbiddenDeliveries=[];return _.each(selection,function(uri){var checkedDelivery,testTakerData=getExecutionData(uri);testTakerData&&((checkedDelivery=function(testTakerData,actionName){var deliveryName,formatted,status
;return deliveryName=_.isObject(testTakerData.delivery)?testTakerData.delivery.label:testTakerData.delivery,formatted={id:testTakerData.id,label:deliveryName+" ["+testTakerData.start_time+"] "+testTakerData.test_taker_first_name+" "+testTakerData.test_taker_last_name},(status=_status.getStatusByCode(testTakerData.state.status))&&(formatted.allowed=!0===status.can[actionName],formatted.allowed||(formatted.reason=status.can[actionName],formatted.warning=status.warning[actionName]?status.warning[actionName](null,testTakerData.id):__("Unable to perform action on test %s.",testTakerData.id))),testTakerData.timer&&(formatted.extraTime=testTakerData.timer.extraTime
,formatted.consumedTime=testTakerData.timer.consumedExtraTime,formatted.remaining_time=testTakerData.timer.remaining_time),formatted}(testTakerData,actionName)).allowed?allowedDeliveries.push(checkedDelivery):forbiddenDeliveries.push(checkedDelivery))}),{resourceType:"session",allowedResources:allowedDeliveries,deniedResources:forbiddenDeliveries}}function execBulkAction(actionName,actionTitle,selection,cb){var _selection=_.isArray(selection)?selection:[selection],askForReason=categories[actionName]&&categories[actionName].categoriesDefinitions&&categories[actionName].categoriesDefinitions.length,config=_.merge(listSessions(actionName,_selection),{
renderTo:$content,actionName:actionTitle,reason:askForReason,reasonRequired:!0,categoriesSelector:cascadingComboBox(categories[actionName]||{})});config.allowedResources.length?bulkActionPopup(config).on("ok",function(reason){_.isFunction(cb)&&cb(_selection,reason)}):feedback().warning(_status.buildWarningMessage(actionName,_selection,config.deniedResources))}function setTagUsage(applyTags){defaultTag&&($list.find(".tag").length||$('<span class="filter"><input type="hidden" name="tag" class="tag" value="'+applyTags+'"/></span>').appendTo($list),$list.find(".tag").val(applyTags),$list.data("applytags",applyTags),applyTags?$list.find(".action-bar").children(
".tool-tag").hide():$list.find(".action-bar").children(".tool-notag").hide())}function statusFilterHandler($el){$el.select2({dropdownAutoWidth:!0,placeholder:__("Filter"),minimumResultsForSearch:1/0,allowClear:!0})}return deliveryId&&(serviceParams.delivery=deliveryId),context&&(serviceParams.context=context),proxyExecutions.read(serviceParams).then(function(data){dataset=data.set,extraFields=data.extrafields,categories=data.categories,deliveryId=data.delivery||deliveryId,context=data.context||context,timeHandlingButton=data.timeHandling,allowedConnectivity=data.onlineStatus||!1,printReportButton=data.printReportButton,printReportUrl=data.printReportUrl,
hasAccessToReactivate=data.hasAccessToReactivate,sessionsHistoryUrl=data.historyUrl||historyUrl,deliveryId&&(serviceParams.delivery=deliveryId),context&&(serviceParams.context=context),data.refreshBtn&&tools.push({id:"refresh",icon:"reset",title:__("Refresh the page"),label:__("Refresh"),action:function(){$list.datatable("refresh")}}),data.autoRefresh&&setInterval(function(){$list.datatable("refresh")},data.autoRefresh),defaultTag&&(tools.push({id:"notag",icon:"filter",css:"btn-warning",label:__("Remove default tag filtering"),title:__("Remove default tag filtering"),action:function(){setTagUsage(!1),$list.datatable("filter")}}),tools.push({id:"tag",
icon:"filter",title:__("Apply default tag"),label:__("Apply default tag"),action:function(){setTagUsage(!0),$list.datatable("filter")}})),tools.push({id:"authorize",icon:"play",title:__("Authorize sessions"),label:__("Authorize"),massAction:!0,action:authorize}),null!==data.canPause&&!data.canPause||tools.push({id:"pause",icon:"pause",title:__("Pause sessions"),label:__("Pause"),massAction:!0,action:pause}),tools.push({id:"terminate",icon:"stop",title:__("Terminate sessions"),label:__("Terminate"),massAction:!0,action:terminate}),tools.push({id:"irregularity",icon:"delivery-small",title:__("Report irregularities"),label:__("Report"),massAction:!0,
action:report}),printReportButton&&tools.push({id:"printReport",title:__("Print the assessment results"),icon:"result",label:__("Print Results"),massAction:!0,action:printReport}),timeHandlingButton&&tools.push({id:"timeHandling",title:__("Session time handling"),icon:"time",label:__("Time"),massAction:!0,action:timeHandling}),model.push({id:"deliveryLabel",label:__("Session"),sortable:!0,transform:function(value,row){var delivery=row&&row.delivery;return delivery&&(value=deliveryLinkTpl(delivery)),value}}),model.push({id:"test_taker_first_name",label:__("First name"),filterable:!0,sortable:!0,transform:function(value,row){
return row&&row.testTaker&&row.testTaker.test_taker_first_name||""}}),model.push({id:"test_taker_last_name",label:__("Last name"),filterable:!0,sortable:!0,transform:function(value,row){return row&&row.testTaker&&row.testTaker.test_taker_last_name||""}}),_.each(extraFields,function(extraField){model.push({id:extraField.id,label:extraField.label,filterable:extraField.filterable,sortable:!0,order:extraField.columnPosition,transform:function(value,row){return row&&row.extraFields&&row.extraFields[extraField.id]||""}})}),model.push({id:"start_time",sortable:!0,label:__("Started at"),filterable:!0,transform:function(value){return locale.formatDateTime(value)},
filterTransform:function(value){var first,last,dateFormat=locale.getDateTimeFormat().split(" ")[0],values=value.split(" "),result="";return 2<=values.length&&(first=values[0],last=values[values.length-1],result+=moment(first,dateFormat).format("X"),result+=" - ",result+=moment(last,dateFormat).add(1,"d").format("X")),result},customFilter:{template:'<input type="text" id="start_time_filter" name="filter[start_time]" placeholder="'+__("Filter")+'"/>',callback:function($elt){var lastValue,$filterContainer=$elt.closest(".filter"),dateFormatStr=locale.getDateTimeFormat().split(" ")[0];$filterContainer.css("position","static"),
startDatePicker&&startDatePicker.destroy(),startDatePicker=dateTimePicker($filterContainer,{setup:"date-range",format:dateFormatStr,replaceField:$elt[0]}).on("change",function(value){var selection=this.getSelectedDates();(""===value&&lastValue!==value||selection&&2===selection.length)&&$list.datatable("filter"),lastValue=value})}}}),model.push({id:"status",label:__("Status"),sortable:!0,filterable:!0,customFilter:{template:statusFilterTpl({statuses:_status.getStatuses()}),callback:statusFilterHandler},transform:function(value,row){var status,result="";return row&&row.state&&row.state.status&&(status=_status.getStatusByCode(row.state.status))&&(
result=status.label,"INPROGRESS"===row.state.status&&(result=status.label),"Awaiting"===result&&highlightRows.push(row.id)),result}}),model.push({id:"authorizeCl",label:__("Authorize"),type:"actions",actions:[{id:"authorize",icon:"play",title:__("Authorize session"),disabled:function(){return!canDo("authorize",this.state)},action:authorize}]}),null!==data.canPause&&!data.canPause||model.push({id:"pauseCl",label:__("Pause"),type:"actions",actions:[{id:"pause",icon:"pause",title:__("Pause session"),disabled:function(){return!canDo("pause",this.state)},action:pause}]}),model.push({id:"remaining_time",sortable:!0,sorttype:"numeric",label:__("Remaining"),
transform:function(value,row){var rowTimer=_.isObject(row.timer)?row.timer:{},refinedValue=rowTimer.approximatedRemaining?rowTimer.approximatedRemaining:rowTimer.remaining_time,remaining=parseInt(refinedValue,10);return(remaining||_.isFinite(remaining))&&(remaining<0&&(rowTimer.extraTime&&rowTimer.consumedExtraTime&&(rowTimer.consumedExtraTime+=-remaining),remaining=0),refinedValue=remaining?(rowTimer.extraTime&&rowTimer.consumedExtraTime&&(remaining-=rowTimer.consumedExtraTime),timeEncoder.encode(remaining)):"",refinedValue=approximatedTimerTpl({timer:refinedValue,remaining:remaining,countDown:rowTimer.countDown})),refinedValue}}),
timeHandlingButton&&model.push({id:"extraTime",label:__("Extra Time"),type:"actions",actions:[{id:"timeHandling",title:__("Session time handling"),icon:"time",action:timeHandling,hidden:function(){var allowExtraTime=_.isNull(this.allowExtraTime)||this.allowExtraTime;return!canDo("time",this.state)||!allowExtraTime}}]}),model.push({id:"extendedTime",label:__("Extended Time"),transform:function(value,row){var extendedTimer=_.isObject(row.timer)?row.timer:{};return(extendedTimer.extendedTime?"x":"")+extendedTimer.extendedTime}}),allowedConnectivity&&model.push({id:"last_connect",sortable:!0,label:__("Connectivity"),transform:function(value,row){
return row.state.status===_status.STATUS_INPROGRESS?row.online?__("online"):__("offline"):""}}),model.push({id:"progress",label:__("Progress"),transform:function(value,row){return row&&row.state&&row.state.progress||""}}),label="Terminate and irregularity",hasAccessToReactivate&&(label="Terminate/Reactivate and irregularity"),actionList=[{id:"terminateOrReactivateAndIrregularity",icon:"delivery-small",title:__(label),action:terminateOrReactivateAndIrregularity},{id:"history",icon:"history",title:__("Show the detailed session history"),action:showHistory}],printReportButton&&actionList.push({id:"printReport",title:__("Print the assessment results"),
icon:"result",action:printReport}),model.push({id:"administrationCl",label:__("Administration"),type:"actions",actions:actionList}),$list.on("query.datatable",function(){loadingBar.start(),highlightRows=[]}).on("load.datatable",function(e,newDataset){var applyTags;dataset=newDataset,actionButtons=_({authorize:$list.find(".action-bar").children(".tool-authorise"),pause:$list.find(".action-bar").children(".tool-pause"),terminate:$list.find(".action-bar").children(".tool-terminate"),report:$list.find(".action-bar").children(".tool-irregularity")}),defaultTag&&(applyTags=$list.data("applytags"),setTagUsage(applyTags=!!_.isUndefined(applyTags)||applyTags)),
highlightRows.length&&_.forEach(highlightRows,function(v){$list.datatable("highlightRow",v)}),loadingBar.stop(),appController.off("change.polling").on("change.polling",function(){polling.stop()}),polling.start(),timer.resume()}).on("select.datatable",function(){actionButtons.each(function($btn){$btn.hide()}),_($list.datatable("selection")).map(function(uri){return getExecutionData(uri).state.status}).uniq().each(function(statusCode){var status=_status.getStatusByCode(statusCode);actionButtons.forIn(function($btn,action){status&&!0===status.can[action]&&$btn.show()})})}).on("error.datatable",function(e,err){appController.onError(err)}).datatable({
url:urlHelper.build(executionsUrl,serviceParams),status:{empty:__("No sessions"),available:function(){return $list.data("applytags")?__("Groups: %s. %s",defaultTag.split(",").join(", "),defaultAvailableLabel):defaultAvailableLabel},loading:__("Loading")},filterStrategy:"multiple",filterSelector:"select, input:not(.select2-input, .select2-focusser)",filtercolumns:{start_time:moment().format("L")+" to "+moment().add("1","d").format("L")},filter:!0,tools:tools,model:model,selectable:!0,sortorder:"desc",sortby:"start_time",pageSizeSelector:!0},dataset),defaultTag&&setTagUsage(!0)})}).catch(function(err){appController.onError(err),loadingBar.stop()})}}}),define(
"taoProctoring/controller/Delivery/testTakers",["jquery","i18n","helpers","layout/loading-bar","util/encode","ui/feedback","taoProctoring/component/breadcrumbs","ui/datatable"],function($,__,helpers,loadingBar,encode,feedback,breadcrumbsFactory){"use strict";return loadingBar.start(),{start:function(){function assign(selection){selection&&selection.length&&(loadingBar.start(),$.ajax({url:assignUrl,data:{testtaker:selection},dataType:"json",type:"POST",error:function(){loadingBar.stop()}}).done(function(response){loadingBar.stop(),response&&response.success?(feedback().success(__("Test takers have been added")),window.location.href=managerUrl):feedback(
).error(__("Something went wrong ...")+"<br>"+encode.html(response.error),{encodeHtml:!1})}))}var $container=$(".delivery-testtakers"),$list=$container.find(".list"),crumbs=$container.data("breadcrumbs"),dataset=$container.data("set"),deliveryId=$container.data("delivery"),testCenterId=$container.data("testcenter"),serviceUrl=helpers._url("availableTestTakers","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),assignUrl=helpers._url("assignTestTakers","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId}),managerUrl=helpers._url("manage","Delivery","taoProctoring",{delivery:deliveryId,testCenter:testCenterId})
;breadcrumbsFactory($container,crumbs);$list.on("query.datatable",function(){loadingBar.start()}).on("load.datatable",function(event,response){loadingBar.stop()}).datatable({url:serviceUrl,status:{empty:__("No available test takers to assign"),available:__("Available test takers"),loading:__("Loading")},tools:[{id:"back",icon:"left",title:__("Return to the session manager"),label:__("Back"),action:function(){window.location.href=managerUrl}},{id:"refresh",icon:"reset",title:__("Refresh the page"),label:__("Refresh"),action:function(){$list.datatable("refresh")}},{id:"assign",icon:"add",title:__("Assign the selected test takers to the session"),label:__(
"Assign the selected test takers"),massAction:!0,action:function(selection){assign(selection)}}],actions:[{id:"assign",icon:"add",title:__("Assign the test taker to the session"),action:function(id){assign([id])}}],selectable:!0,model:[{id:"firstname",label:__("First name")},{id:"lastname",label:__("Last name")},{id:"identifier",label:__("Identifier")}]},dataset)}}}),define("tpl!taoProctoring/templates/deliveryServer/authorizationSuccess",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var helper,buffer=""
;return buffer+='<span class="success-message">',buffer+=(0,this.escapeExpression)((helper=helpers.message)?helper.call(depth0,{hash:{},data:data}):"function"==typeof(helper=depth0&&depth0.message)?helper.call(depth0,{hash:{},data:data}):helper)+'<span class="icon-result-ok"></span></span>'})}),define("tpl!taoProctoring/templates/deliveryServer/authorizationListBoxActions",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],data=data||{};var stack1,helper,options,buffer="",helperMissing=(helpers=this.merge(helpers,Handlebars.helpers)).helperMissing,
escapeExpression=this.escapeExpression;return buffer+='<span class="listbox-actions">\n    ',!(stack1=helpers.if.call(depth0,depth0&&depth0.cancelable,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var helper,options,buffer="";return buffer+='\n    <span class="action cancel js-cancel">\n        <span class="icon-stop"></span>'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Cancel",options):helperMissing.call(depth0,"__","Cancel",options)))+"\n    </span>\n    "},data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+='\n    <span class="action play js-proceed" data-delivery="',
stack1=(helper=helpers.id)?helper.call(depth0,{hash:{},data:data}):"function"==typeof(helper=depth0&&depth0.id)?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+'">\n        <span class="icon-play"></span>'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Proceed",options):helperMissing.call(depth0,"__","Proceed",options)))+"\n    </span>\n</span>"})}),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("jquery"),require("core/eventifier")):"function"==typeof define&&define.amd?define("util/clipboard",["jquery",
"core/eventifier"],factory):(global=global||self)["util/clipboard"]=factory(global.$,global["core/eventifier"])}(this,function($,eventifier){"use strict";return $=$&&$.hasOwnProperty("default")?$.default:$,(eventifier=eventifier&&eventifier.hasOwnProperty("default")?eventifier.default:eventifier)({clean:function(){this.copy(" ")},copy:function(text){var textAreaToSelContent;(textAreaToSelContent=document.createElement("textarea")).setAttribute("id","clipboardCleanerPlugin"),textAreaToSelContent.value=text,textAreaToSelContent.setAttribute("readonly",""),textAreaToSelContent.style.position="absolute",textAreaToSelContent.style.left="-9999px",
document.body.appendChild(textAreaToSelContent),this.copyFromEl(textAreaToSelContent),document.body.removeChild(textAreaToSelContent)},copyFromEl:function(elem){var textRange,editable,readOnly,range,sel,el;el=elem instanceof $?elem.get(0):elem,document.body.createTextRange?((textRange=document.body.createTextRange()).moveToElementText(el),textRange.select(),textRange.execCommand("Copy"),this.trigger("copied",{srcEl:el})):window.getSelection&&document.createRange&&(el.hasOwnProperty("contentEditable")&&(editable=el.contentEditable,el.contentEditable=!0),el.hasOwnProperty("readOnly")&&(readOnly=el.readOnly,el.readOnly=!1),(range=document.createRange()
).selectNodeContents(el),(sel=window.getSelection()).removeAllRanges(),sel.addRange(range),"TEXTAREA"!==el.nodeName&&"INPUT"!==el.nodeName||el.select(),el.setSelectionRange&&navigator.userAgent.match(/ipad|ipod|iphone/i)&&el.setSelectionRange(0,999999),el.hasOwnProperty("contentEditable")&&(el.contentEditable=editable),el.hasOwnProperty("readOnly")&&(el.readOnly=readOnly),document.queryCommandSupported("copy")?document.execCommand("copy")?this.trigger("copied",{srcEl:elem}):this.trigger("copyError",{srcEl:elem,reason:"Not Success"}):navigator.userAgent.match(/ipad|ipod|iphone|android|silk/i)||this.trigger("copyError",{srcEl:elem,
reason:"Copy command not supported"}))},paste:function(elem){var el,editable,readOnly,range,sel;el=elem instanceof $?elem.get(0):elem,window.clipboardData?(el.value=window.clipboardData.getData("Text"),el.innerHTML=window.clipboardData.getData("Text")):window.getSelection&&document.createRange&&(el.tagName.match(/textarea|input/i)&&el.value.length<1?el.value=" ":el.innerHTML.length<1&&(el.innerHTML="&nbsp;"),editable=el.contentEditable,readOnly=el.readOnly,el.contentEditable=!0,el.readOnly=!1,(range=document.createRange()).selectNodeContents(el),(sel=window.getSelection()).removeAllRanges(),sel.addRange(range),
"TEXTAREA"!==el.nodeName&&"INPUT"!==el.nodeName||el.select(),el.setSelectionRange&&navigator.userAgent.match(/ipad|ipod|iphone/i)&&el.setSelectionRange(0,999999),document.queryCommandSupported("paste")?document.execCommand("Paste")?this.trigger("pasted",{srcEl:elem}):navigator.userAgent.match(/android/i)&&navigator.userAgent.match(/chrome/i)?(this.trigger("pasteError",{srcEl:elem,reason:"Extra action required"}),el.tagName.match(/textarea|input/i)?(el.value=" ",el.focus(),el.setSelectionRange(0,0)):el.innerHTML=""):this.trigger("pasteError",{srcEl:elem,reason:"Press CTRL-V to paste"}):this.trigger("pasteError",{srcEl:elem,reason:"Command paste not supported"
}),el.contentEditable=editable,el.readOnly=readOnly)}})}),define("taoProctoring/controller/DeliveryServer/awaiting",["lodash","jquery","i18n","helpers","layout/loading-bar","ui/listbox","ui/dialog/alert","core/polling","taoQtiTest/testRunner/resumingStrategy/keepAfterResume","util/url","ui/dialog/confirm","tpl!taoProctoring/templates/deliveryServer/authorizationSuccess","tpl!taoProctoring/templates/deliveryServer/authorizationListBoxActions","util/clipboard"],function(_,$,__,helpers,loadingBar,listBox,dialogAlert,polling,keepAfterResume,url,dialogConfirm,authSuccessTpl,listBoxActionsTpl,clipboard){"use strict";return{start:function(config){var $container=$(
".awaiting-authorization"),isAuthorizedUrl=helpers._url("isAuthorized","DeliveryServer","taoProctoring",{deliveryExecution:config.deliveryExecution}),runDeliveryUrl=config.runDeliveryUrl,boxes=[{id:"goToDelivery",label:config.deliveryLabel,url:runDeliveryUrl,content:__("Please wait, authorization in process ..."),html:listBoxActionsTpl({id:config.deliveryExecution,cancelable:config.cancelable})}],$content=(listBox({title:"",textEmpty:"",textNumber:"",textLoading:"",renderTo:$container,list:boxes,width:12}),$container.find(".listbox .content")),deliveryStarted=!1,runDelivery=function(){loadingBar.start(),clipboard.clean(),deliveryStarted=!0,
window.location.href=runDeliveryUrl},isRunnable=function(){return!$container.hasClass("authorization-in-progress")&&!deliveryStarted};function exit(){window.location.href=config.returnUrl}keepAfterResume().reset(),loadingBar.start(!1),$container.on("click",".js-cancel",function(e){e.stopPropagation(),e.preventDefault(),dialogConfirm(__("Are you sure you want to end the test?"),function(){window.location.href=config.cancelUrl})}),$container.on("click",".js-proceed",function(e){return isRunnable()&&runDelivery(),!1}),$container.on("click",".block.box",function(e){return isRunnable()&&runDelivery(),!1}),polling({action:function(){var async=this.async();$.get(
isAuthorizedUrl,function(result){var stop=!1;result.success?result.authorized&&(stop=!0,$content.html(authSuccessTpl({message:__("Authorized, you may proceed")})),loadingBar.stop(),$container.addClass("authorization-granted").removeClass("authorization-in-progress")):(stop=!0,result.message?dialogAlert(result.message,exit):exit()),stop?async.reject():async.resolve()})},interval:1e4,autoStart:!0}).next()}}}),define("taoProctoring/controller/Irregularity/index",["jquery","lodash","i18n","ui/hider","util/url","ui/feedback","ui/taskQueue/taskQueue","ui/taskQueueButton/standardButton"],function($,_,__,hider,urlHelper,feedback,taskQueue,taskCreationButtonFactory){
"use strict";return{start:function(){var taskCreationButton,purpose,$header=$("header.section-header"),$formContainer=$(".print-form"),$reportContainer=$(".print-report"),$form=$("form",$formContainer),$submitter=$(".form-submitter",$form),$containers=$(".main-container");function refreshTree(){$(".tree").trigger("refresh.taotree",[{uri:$header.data("select-node")}])}purpose="form",hider.hide($containers),hider.show($containers.filter('[data-purpose="'+purpose+'"]')),taskCreationButton=taskCreationButtonFactory({type:"info",icon:"export",title:__("Export Irregularities"),label:__("Export"),taskQueue:taskQueue,taskCreationUrl:$form.prop("action"),
taskCreationData:function(){return $form.serializeArray()},taskReportContainer:$reportContainer}).on("finished",function(result){result.task&&result.task.report&&_.isArray(result.task.report.children)&&result.task.report.children.length&&result.task.report.children[0]&&(result.task.report.children[0].data&&result.task.report.children[0].data.uriResource?(feedback().info(__("%s completed",result.task.taskLabel)),refreshTree(result.task.report.children[0].data.uriResource)):this.displayReport(result.task.report.children[0],__("Error")))}).on("continue",function(){refreshTree()}).on("error",function(err){feedback().error(err)}).render($submitter.closest(
".form-toolbar")),$submitter.replaceWith(taskCreationButton.getElement().css({float:"right"}))}}}),define("taoProctoring/component/history/historyTable",["jquery","lodash","i18n","ui/component","ui/datatable"],function($,_,__,component){"use strict";var _defaults={sortBy:"timestamp",sortOrder:"desc"};function renderDetails(details){return _.isArray(details)&&(details=details.join("<br />")),details}return function(config,data){var initConfig=_.defaults(config||{},_defaults);return component({refresh:function(params){var $element;this.is("rendered")?($element=this.getElement(),params&&$element.datatable("options",{params:params}),$element.datatable("refresh")
):params&&(initConfig.params=_.merge(initConfig.params,params))}}).on("render",function(){var self=this,tools=[{id:"refresh",icon:"reset",title:__("Refresh the page"),label:__("Refresh"),action:function(){self.refresh()}}];this.getElement().on("query.datatable",function(){self.trigger("loading")}).on("load.datatable",function(){self.trigger("loaded")}).on("error.datatable",function(e,err){self.trigger("error",err)}).datatable({url:initConfig.service,params:initConfig.params,sortby:initConfig.sortBy,sortorder:initConfig.sortOrder,status:{empty:__("No history to display!"),available:__("Available history"),loading:__("Loading")},selectable:!(
!initConfig.tools||!_.find(initConfig.tools,{massAction:!0})),tools:tools.concat(initConfig.tools||[]),model:[{id:"date",label:__("Date"),sortable:!0},{id:"role",label:__("Role"),sortable:!0},{id:"actor",label:__("Actor"),sortable:!0},{id:"event",label:__("Event"),sortable:!0},{id:"details",label:__("Details"),transform:renderDetails},{id:"context",label:__("Context"),transform:renderDetails}]},data)}).init(initConfig)}}),define("tpl!taoProctoring/templates/reporting/index",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var stack1,buffer="",functionType="function",escapeExpression=this.escapeExpression;return buffer+='<div class="content">\n    ',!(stack1=helpers.if.call(depth0,depth0&&depth0.title,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,data){var stack1,helper,buffer="";return buffer+="<h1>",stack1=(helper=helpers.title)?helper.call(depth0,{hash:{},data:data}):typeof(helper=depth0&&depth0.title)===functionType?helper.call(depth0,{hash:{},data:data}):helper,buffer+=escapeExpression(stack1)+"</h1>"},data),data:data}))&&0!==stack1||(buffer+=stack1),buffer+='\n    <div class="panel"></div>\n    <div class="list clearfix"></div>\n</div>'})}),
define("taoProctoring/controller/Reporting/history",["lodash","i18n","util/url","controller/app","layout/loading-bar","ui/container","ui/button","ui/dateRange/dateRange","util/encode","util/locale","taoProctoring/component/proxy","taoProctoring/component/history/historyTable","tpl!taoProctoring/templates/reporting/index","ui/datatable"],function(_,__,urlHelper,appController,loadingBar,containerFactory,buttonFactory,dateRangeFactory,encode,locale,proxyFactory,historyTableFactory,indexTpl){"use strict";var serviceUrl=urlHelper.route("sessionHistory","Reporting","taoProctoring"),sessionsUrl=urlHelper.route("history","Reporting","taoProctoring")
;return loadingBar.start(),{start:function(){var container=containerFactory().changeScope(".session-history").write(indexTpl()),currentRoute=urlHelper.parse(window.location.href),context=currentRoute.query.context&&decodeURIComponent(currentRoute.query.context),deliveryId=currentRoute.query.delivery&&decodeURIComponent(currentRoute.query.delivery),sessions=decodeURIComponent(currentRoute.query.session).split(","),monitoringUrl=currentRoute.query.monitoring&&decodeURIComponent(currentRoute.query.monitoring),dateFormat=locale.getDateTimeFormat().split(" ")[0];appController.on("set-referrer.history",function(route){monitoringUrl=route}).on("change.history",
function(){appController.off(".history"),container.destroy()}),proxyFactory("ajax").init({actions:{read:serviceUrl}}).then(function(proxyService){return proxyService.read({delivery:deliveryId,context:context,session:sessions}).then(function(data){var detailedHistory=data.detailedHistory,historyTable=historyTableFactory({tools:[{id:"show-detailed-report",icon:"insert-horizontal-line",title:__("Show detailed session history messages"),label:__("Show detailed report"),action:function(){var tool=_.find(historyTable.config.tools,{id:"show-detailed-report"});historyTable.config.params.detailed=detailedHistory=!detailedHistory,tool.label=__(
detailedHistory?"Show brief report":"Show detailed report"),historyTable.refresh()}}],params:{detailed:detailedHistory,delivery:deliveryId,context:context,session:sessions},service:sessionsUrl,sortBy:data.sortBy,sortOrder:data.sortOrder},data.set).on("loading",function(){loadingBar.start()}).on("loaded",function(){loadingBar.stop()}).on("error",function(err){appController.onError(err)}).render(container.find(".list"));return data.monitoringUrl&&(monitoringUrl=data.monitoringUrl),new Promise(function(resolve,reject){dateRangeFactory(container.find(".panel"),{resetButton:{enable:!1},applyButton:{enable:!0,label:__("Filter"),title:__(
"Filter by the selected dates")},startPicker:{setup:"date",format:dateFormat,field:{value:data.periodStart,name:"periodStart"}},endPicker:{setup:"date",format:dateFormat,field:{value:data.periodEnd,name:"periodEnd"}}}).on("ready",resolve).on("error",reject).on("submit reset",function(){historyTable.refresh({periodStart:this.getStart(),periodEnd:this.getEnd()})})}).then(function(){buttonFactory({id:"back",type:"info",label:__("Back to sessions"),cls:"back-button",renderTo:container.find(".panel")}).on("click",function(){monitoringUrl?appController.getRouter().redirect(monitoringUrl):history.go(-1)})})})}).catch(function(err){appController.onError(err),
loadingBar.stop()})}}}),define("taoProctoring/controller/routes",{Reporting:{actions:{index:"controller/Reporting/history"}},Irregularity:{actions:{index:"controller/Irregularity/index"}},DeliverySelection:{actions:{index:"controller/Delivery/index"}},Monitor:{actions:{index:"controller/Delivery/monitoring"}},Tools:{css:"tools",actions:{assessmentActivity:"controller/Tools/assessmentActivity"}}}),define("tpl!taoProctoring/component/activityMonitoring/userActivity/userActivityBlock",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),
data=data||{};var helper,buffer="",escapeExpression=this.escapeExpression;return buffer+='<div class="col-',buffer+=escapeExpression((helper=helpers.size)?helper.call(depth0,{hash:{},data:data}):"function"==typeof(helper=depth0&&depth0.size)?helper.call(depth0,{hash:{},data:data}):helper)+' dashboard-block">\n        <span class="dashboard-block-number ',buffer+=escapeExpression((helper=helpers.container)?helper.call(depth0,{hash:{},data:data}):"function"==typeof(helper=depth0&&depth0.container)?helper.call(depth0,{hash:{},data:data}):helper)+'">\n            ',buffer+=escapeExpression((helper=helpers.value)?helper.call(depth0,{hash:{},data:data}
):"function"==typeof(helper=depth0&&depth0.value)?helper.call(depth0,{hash:{},data:data}):helper)+'\n        </span>\n    <h3>\n        <span class="icon icon-test-',buffer+=escapeExpression((helper=helpers.icon)?helper.call(depth0,{hash:{},data:data}):"function"==typeof(helper=depth0&&depth0.icon)?helper.call(depth0,{hash:{},data:data}):helper)+'"></span>\n        ',buffer+=escapeExpression((helper=helpers.label)?helper.call(depth0,{hash:{},data:data}):"function"==typeof(helper=depth0&&depth0.label)?helper.call(depth0,{hash:{},data:data}):helper)+"\n    </h3>\n</div>"})}),define("tpl!taoProctoring/component/activityMonitoring/userActivity/userActivity",[
"handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),partials=this.merge(partials,Handlebars.partials),data=data||{};var stack1,buffer="",self=this;return buffer+="<div>\n    ",!(stack1=helpers.each.call(depth0,depth0,{hash:{},inverse:self.noop,fn:self.program(1,function(depth0,data){var stack1,buffer="";return buffer+="\n    ",!(stack1=self.invokePartial(partials["ui-activity-widget-group"],"ui-activity-widget-group",depth0,helpers,partials,data))&&0!==stack1||(buffer+=stack1),buffer+="\n    "},data),data:data}))&&0!==stack1||(
buffer+=stack1),buffer+="\n</div>"})}),define("taoProctoring/component/activityMonitoring/userActivity/userActivity",["jquery","lodash","i18n","ui/component","handlebars","tpl!taoProctoring/component/activityMonitoring/userActivity/userActivityBlock","tpl!taoProctoring/component/activityMonitoring/userActivity/userActivity"],function($,_,__,component,Handlebars,groupTpl,componentTpl){"use strict";var _defaults={activeProctors:{container:"active-proctors",label:__("Active proctors"),size:4,icon:"taker",value:0},activeTestTakers:{container:"active-test-takers",label:__("Active test-takers"),size:4,icon:"takers",value:0}};return Handlebars.registerPartial(
"ui-activity-widget-group",groupTpl),function(config){return config=config||{},component({update:function(data){var metricsWidget;for(metricsWidget in _.merge(this.config,data),this.config)this.config.hasOwnProperty(metricsWidget)&&$("."+this.config[metricsWidget].container,this.getElement()).text(this.config[metricsWidget].value)}},_defaults).setTemplate(componentTpl).init(config)}}),define("tpl!taoProctoring/component/activityMonitoring/currentAssessmentActivity/currentAssessmentActivity",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,
Handlebars.helpers),data=data||{};var stack1,buffer="",escapeExpression=this.escapeExpression;return buffer+='<div>\n    <div class="col-4 dashboard-block">\n        <h4>\n            <span class="icon icon-play"></span>\n            '+escapeExpression("function"==typeof(stack1=null==(stack1=null==(stack1=depth0&&depth0.assessments)||!1===stack1?stack1:stack1.current)||!1===stack1?stack1:stack1.label)?stack1.apply(depth0):stack1)+'\n        </h4>\n        <span class="dashboard-block-number '+escapeExpression("function"==typeof(stack1=null==(stack1=null==(stack1=depth0&&depth0.assessments)||!1===stack1?stack1:stack1.current
)||!1===stack1?stack1:stack1.container)?stack1.apply(depth0):stack1)+'">\n            '+escapeExpression("function"==typeof(stack1=null==(stack1=null==(stack1=depth0&&depth0.assessments)||!1===stack1?stack1:stack1.current)||!1===stack1?stack1:stack1.value)?stack1.apply(depth0):stack1)+'\n        </span>\n    </div>\n\n    <div class="col-2 dashboard-block">\n        <h4>\n            <span class="icon icon-play"></span>\n            '+escapeExpression("function"==typeof(stack1=null==(stack1=null==(stack1=depth0&&depth0.assessments)||!1===stack1?stack1:stack1.inProgress)||!1===stack1?stack1:stack1.label)?stack1.apply(depth0):stack1
)+'\n        </h4>\n        <span class="dashboard-block-number '+escapeExpression("function"==typeof(stack1=null==(stack1=null==(stack1=depth0&&depth0.assessments)||!1===stack1?stack1:stack1.inProgress)||!1===stack1?stack1:stack1.container)?stack1.apply(depth0):stack1)+'">\n            '+escapeExpression("function"==typeof(stack1=null==(stack1=null==(stack1=depth0&&depth0.assessments)||!1===stack1?stack1:stack1.inProgress)||!1===stack1?stack1:stack1.value)?stack1.apply(depth0):stack1)+'\n        </span>\n    </div>\n\n    <div class="col-2 dashboard-block">\n        <h4>\n            <span class="icon icon-time"></span>\n            '+escapeExpression(
"function"==typeof(stack1=null==(stack1=null==(stack1=depth0&&depth0.assessments)||!1===stack1?stack1:stack1.awaiting)||!1===stack1?stack1:stack1.label)?stack1.apply(depth0):stack1)+'\n        </h4>\n        <span class="dashboard-block-number '+escapeExpression("function"==typeof(stack1=null==(stack1=null==(stack1=depth0&&depth0.assessments)||!1===stack1?stack1:stack1.awaiting)||!1===stack1?stack1:stack1.container)?stack1.apply(depth0):stack1)+'">\n            '+escapeExpression("function"==typeof(stack1=null==(stack1=null==(stack1=depth0&&depth0.assessments)||!1===stack1?stack1:stack1.awaiting)||!1===stack1?stack1:stack1.value)?stack1.apply(depth0):stack1
)+'\n        </span>\n    </div>\n\n    <div class="col-2 dashboard-block">\n        <h4>\n            <span class="icon icon-continue"></span>\n            '+escapeExpression("function"==typeof(stack1=null==(stack1=null==(stack1=depth0&&depth0.assessments)||!1===stack1?stack1:stack1.authorized)||!1===stack1?stack1:stack1.label)?stack1.apply(depth0):stack1)+'\n        </h4>\n        <span class="dashboard-block-number '+escapeExpression("function"==typeof(stack1=null==(stack1=null==(stack1=depth0&&depth0.assessments)||!1===stack1?stack1:stack1.authorized)||!1===stack1?stack1:stack1.container)?stack1.apply(depth0):stack1)+'">\n            '+escapeExpression(
"function"==typeof(stack1=null==(stack1=null==(stack1=depth0&&depth0.assessments)||!1===stack1?stack1:stack1.authorized)||!1===stack1?stack1:stack1.value)?stack1.apply(depth0):stack1)+'\n        </span>\n    </div>\n\n    <div class="col-2 dashboard-block">\n        <h4>\n            <span class="icon icon-pause"></span>\n            '+escapeExpression("function"==typeof(stack1=null==(stack1=null==(stack1=depth0&&depth0.assessments)||!1===stack1?stack1:stack1.paused)||!1===stack1?stack1:stack1.label)?stack1.apply(depth0):stack1)+'\n        </h4>\n        <span class="dashboard-block-number '+escapeExpression("function"==typeof(stack1=null==(stack1=null==(
stack1=depth0&&depth0.assessments)||!1===stack1?stack1:stack1.paused)||!1===stack1?stack1:stack1.container)?stack1.apply(depth0):stack1)+'">\n            '+escapeExpression("function"==typeof(stack1=null==(stack1=null==(stack1=depth0&&depth0.assessments)||!1===stack1?stack1:stack1.paused)||!1===stack1?stack1:stack1.value)?stack1.apply(depth0):stack1)+"\n        </span>\n    </div>\n</div>"})}),define("taoProctoring/component/activityMonitoring/currentAssessmentActivity/currentAssessmentActivity",["jquery","lodash","i18n","ui/component","tpl!taoProctoring/component/activityMonitoring/currentAssessmentActivity/currentAssessmentActivity"],function($,_,__,
component,tpl){"use strict";var _defaults={assessments:{awaiting:{container:"awaiting-assessments",label:__("Awaiting"),value:0},authorized:{container:"authorized-but-not-started-assessments",label:__("Authorized"),value:0},current:{container:"current-assessments",label:__("Total Current Assessments"),value:0},inProgress:{container:"in-progress-assessments",label:__("In Progress"),value:0},paused:{container:"paused-assessments",label:__("Paused"),value:0}}};return function(config){return config=config||{},component({update:function(data){_.merge(this.config.assessments,data),_.each(this.config.assessments,function(val){$("."+val.container,this.getElement()
).text(val.value)},this)}},_defaults).setTemplate(tpl).init(config)}}),define("tpl!taoProctoring/component/activityMonitoring/progressbar",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},'<div class="js-completed-assessments-refresh-bar refresh-bar">\n    <div class="js-refresh-bar-progress refresh-bar-progress"></div>\n</div>'})}),define("taoProctoring/component/activityMonitoring/activityGraph",["jquery","lodash","i18n","ui/component","util/url","c3",
"tpl!taoProctoring/component/activityMonitoring/progressbar","core/polling"],function($,_,__,component,url,c3,progressbarTpl,pollingFactory){"use strict";var _defaults={autoRefresh:0,autoRefreshBar:!1,transition:{duration:3e3},graphConfig:{padding:{bottom:0,left:35},data:{x:"time",xFormat:"%Y-%m-%d %H:%M:%S",mimeType:"json",type:"bar"},axis:{x:{type:"timeseries",tick:{format:"%H:%M"},label:{position:"bottom center"}},y:{label:{position:"top"}}}}};function runRefreshProgressBar($refreshProgress,duration){duration/=1e3,$refreshProgress.css({"-webkit-transition":"width 0s","-moz-transition":"width 0s","-o-transition":"width 0s",transition:"width 0s",width:"0%"}
),$refreshProgress.hide().show(),$refreshProgress.css({"-webkit-transition":"width "+duration+"s linear","-moz-transition":"width "+duration+"s linear","-o-transition":"width "+duration+"s linear",transition:"width "+duration+"s linear",width:"100%"})}return function(config){var chart,$refreshProgress,$progressbar,polling,initConfig=_.merge({},_defaults,config);return component({refresh:function(newConfig){chart&&(initConfig=_.merge({},initConfig,newConfig),chart.internal.config.axis_x_tick_format=initConfig.graphConfig.axis.x.tick.format,chart.axis.labels({x:initConfig.graphConfig.axis.x.label.text}),chart.load(initConfig.graphConfig.data))}}).on("render",
function(){chart=c3.generate(initConfig.graphConfig),initConfig.autoRefresh&&($progressbar=$(progressbarTpl()),$(initConfig.graphConfig.bindto).after($progressbar),$refreshProgress=$progressbar.find(".js-refresh-bar-progress"),initConfig.autoRefreshBar&&runRefreshProgressBar($refreshProgress,initConfig.autoRefresh),polling=pollingFactory({action:function(){chart.load(initConfig.graphConfig.data),initConfig.autoRefreshBar&&runRefreshProgressBar($refreshProgress,initConfig.autoRefresh)},interval:initConfig.autoRefresh,autoStart:!0}))}).on("destroy",function(){polling&&polling.stop()}).init(initConfig)}}),define(
"taoProctoring/component/activityMonitoring/deliveriesList/deliveriesList",["jquery","i18n","util/url","ui/component","util/locale","ui/datatable"],function($,__,url,component,locale){"use strict";var _defaults={model:[{id:"label",label:__("Delivery"),sortable:!0},{id:__("Awaiting"),label:__("Awaiting"),sortable:!0,transform:function(value){return value.toString()}},{id:__("Authorized"),label:__("Authorized"),sortable:!0,transform:function(value){return value.toString()}},{id:__("Paused"),label:__("Paused"),sortable:!0,transform:function(value){return value.toString()}},{id:__("Active"),label:__("Active"),sortable:!0,transform:function(value){
return value.toString()}},{id:__("Terminated"),label:__("Terminated"),sortable:!0,transform:function(value){return value.toString()}},{id:__("Canceled"),label:__("Canceled"),sortable:!0,transform:function(value){return value.toString()}},{id:__("Finished"),label:__("Finished"),sortable:!0,transform:function(value){return value.toString()}},{id:__("Last launch"),label:__("Last launch"),sortable:!0,transform:function(value){return locale.formatDateTime(value)}}]};return function(config){return config=config||{},component({update:function(){this.$datatable.datatable("refresh")}},_defaults).on("render",function(){this.$datatable=this.getElement().datatable({
url:url.route("deliveriesActivityData","Tools","taoProctoring"),filter:!1,model:this.config.model,paginationStrategyTop:"none",paginationStrategyBottom:"simple",rows:10,selectable:!0,sortorder:"asc",sortby:"label"},this.config.model)}).init(config)}}),define("taoProctoring/controller/Tools/assessmentActivity",["jquery","d3","lodash","i18n","helpers","util/url","core/dataProvider/request","core/polling","ui/feedback","ui/cascadingComboBox","ui/bulkActionPopup","taoProctoring/component/activityMonitoring/userActivity/userActivity","taoProctoring/component/activityMonitoring/currentAssessmentActivity/currentAssessmentActivity",
"taoProctoring/component/activityMonitoring/activityGraph","taoProctoring/component/activityMonitoring/deliveriesList/deliveriesList"],function($,d3,_,__,helpers,url,request,polling,feedback,cascadingComboBox,bulkActionPopup,userActivityFactory,currentAssessmentActivityFactory,activityGraphFactory,deliveriesListFactory){"use strict";var pauseMsg=__("Warning, you are about to pause all in progress tests. All test takers will be paused on or before the next heartbeat. Please provide a reason for this action.");return{start:function(){var activityGraph,assessmentActivityAutoRefreshInterval,completedAssessmentsAutoRefreshInterval,config,currentAssessmentActivity
,deliveriesList,pauseReasonCategories,poll,userActivity,$container=$(".activity-dashboard");config=$container.data("config"),assessmentActivityAutoRefreshInterval=1e3*parseInt(config.assessment_activity_auto_refresh),completedAssessmentsAutoRefreshInterval=1e3*parseInt(config.completed_assessments_auto_refresh),userActivity=userActivityFactory(config.userActivityWidgets).render($(".user-activity",$container)),currentAssessmentActivity=currentAssessmentActivityFactory().render($(".assessment-activity",$container)),activityGraph=activityGraphFactory({autoRefresh:Math.max(completedAssessmentsAutoRefreshInterval,assessmentActivityAutoRefreshInterval),
autoRefreshBar:!0,graphConfig:{bindto:$(".js-completed-assessments",$container).selector,data:{url:url.route("completedAssessmentsData","Tools","taoProctoring")},axis:{x:{label:{text:__("Hours")}},y:{label:{text:__("Completed tests")},tick:{format:d3.format("d")}}},tooltip:{format:{name:function(){return __("Completed")}}},legend:{show:!1}}}).render(),$(".js-activity-chart-interval",$container).on("change",function(){var interval=$(this).val();activityGraph.refresh({graphConfig:{data:{url:url.route("completedAssessmentsData","Tools","taoProctoring",{interval:interval})},axis:{x:{tick:{format:"day"===interval?"%H:%M":"%m-%d"},label:{text:__(
"day"===interval?"Hours":"Days")}}}}})}),deliveriesList=deliveriesListFactory().render($(".js-delivery-list")),poll=polling({action:function(){request(url.route("assessmentActivityData","Tools","taoProctoring")).then(function(data){var uaData={};data&&data.group_user_activity&&_.forEach(data.group_user_activity,function(v,k){uaData[$.camelCase(k.replace(/_/g,"-"))]={value:v}}),userActivity.update(uaData),currentAssessmentActivity.update({awaiting:{value:data&&data.awaiting_assessments},authorized:{value:data&&data.authorized_but_not_started_assessments},current:{value:data&&data.total_current_assessments},inProgress:{value:data&&data.in_progress_assessments
},paused:{value:data&&data.paused_assessments}}),deliveriesList.update()}).catch(function(err){feedback().error(err.message),poll.stop()})}}).next().stop(),assessmentActivityAutoRefreshInterval&&(poll.setInterval(assessmentActivityAutoRefreshInterval),poll.start()),pauseReasonCategories=$(".js-pause-active-executions-container").data("reasoncategories"),$(".js-pause",$container).on("click",function(){bulkActionPopup({renderTo:$(".js-pause-active-executions-container",$container),actionName:pauseMsg,reason:!0,allowedResources:[],reasonRequired:!0,categoriesSelector:cascadingComboBox(pauseReasonCategories.pause)}).on("ok",function(reason){!function(reason){
request(url.route("pauseActiveExecutions","Tools","taoProctoring"),{reason:reason},"POST").then(function(data){helpers.loaded(),feedback().success(data.message)}).catch(function(err){helpers.loaded(),feedback().error(err.message)})}(reason)})})}}}),define("taoProctoring/helper/textConverter",["jquery","lodash","core/format","core/promise","util/url"],function($,_,format,Promise,url){"use strict";var pendingPromise,labels=null,proctoringLabels={get:function(message){null==labels[message]&&console.log(message);var localized=labels[message]?labels[message]:message;return 1<arguments.length&&(arguments[0]=localized,localized=format.apply(null,arguments)),
localized}};return function(){return pendingPromise||(pendingPromise=new Promise(function(resolve,reject){$.ajax({url:url.route("getAll","TextConverter","taoProctoring"),type:"POST",dataType:"json"}).done(function(data){labels=data.translations,resolve(proctoringLabels)}).fail(reject)})),pendingPromise}}),define("taoProctoring/loader/taoProctoring.bundle",function(){}),window.bundles=(window.bundles||[]).concat(["taoQtiItem/loader/taoQtiItem.min","taoItems/loader/taoItems.min","taoQtiTest/loader/taoQtiTest.min"]);
//# sourceMappingURL=taoProctoring.min.js.map